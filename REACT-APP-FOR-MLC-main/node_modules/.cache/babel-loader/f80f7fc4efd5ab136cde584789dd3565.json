{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar tinycolor = require('tinycolor2');\n\nvar Plots = require('../../plots/plots');\n\nvar Registry = require('../../registry');\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar dragElement = require('../dragelement');\n\nvar Lib = require('../../lib');\n\nvar strTranslate = Lib.strTranslate;\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar setCursor = require('../../lib/setcursor');\n\nvar Drawing = require('../drawing');\n\nvar Color = require('../color');\n\nvar Titles = require('../titles');\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar flipScale = require('../colorscale/helpers').flipScale;\n\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\n\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\n\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\n\nvar alignmentConstants = require('../../constants/alignment');\n\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar cn = require('./constants').cn;\n\nfunction draw(gd) {\n  var fullLayout = gd._fullLayout;\n\n  var colorBars = fullLayout._infolayer.selectAll('g.' + cn.colorbar).data(makeColorBarData(gd), function (opts) {\n    return opts._id;\n  });\n\n  colorBars.enter().append('g').attr('class', function (opts) {\n    return opts._id;\n  }).classed(cn.colorbar, true);\n  colorBars.each(function (opts) {\n    var g = d3.select(this);\n    Lib.ensureSingle(g, 'rect', cn.cbbg);\n    Lib.ensureSingle(g, 'g', cn.cbfills);\n    Lib.ensureSingle(g, 'g', cn.cblines);\n    Lib.ensureSingle(g, 'g', cn.cbaxis, function (s) {\n      s.classed(cn.crisp, true);\n    });\n    Lib.ensureSingle(g, 'g', cn.cbtitleunshift, function (s) {\n      s.append('g').classed(cn.cbtitle, true);\n    });\n    Lib.ensureSingle(g, 'rect', cn.cboutline);\n    var done = drawColorBar(g, opts, gd);\n    if (done && done.then) (gd._promises || []).push(done);\n\n    if (gd._context.edits.colorbarPosition) {\n      makeEditable(g, opts, gd);\n    }\n  });\n  colorBars.exit().each(function (opts) {\n    Plots.autoMargin(gd, opts._id);\n  }).remove();\n  colorBars.order();\n}\n\nfunction makeColorBarData(gd) {\n  var fullLayout = gd._fullLayout;\n  var calcdata = gd.calcdata;\n  var out = []; // single out item\n\n  var opts; // colorbar attr parent container\n\n  var cont; // trace attr container\n\n  var trace; // colorbar options\n\n  var cbOpt;\n\n  function initOpts(opts) {\n    return extendFlat(opts, {\n      // fillcolor can be a d3 scale, domain is z values, range is colors\n      // or leave it out for no fill,\n      // or set to a string constant for single-color fill\n      _fillcolor: null,\n      // line.color has the same options as fillcolor\n      _line: {\n        color: null,\n        width: null,\n        dash: null\n      },\n      // levels of lines to draw.\n      // note that this DOES NOT determine the extent of the bar\n      // that's given by the domain of fillcolor\n      // (or line.color if no fillcolor domain)\n      _levels: {\n        start: null,\n        end: null,\n        size: null\n      },\n      // separate fill levels (for example, heatmap coloring of a\n      // contour map) if this is omitted, fillcolors will be\n      // evaluated halfway between levels\n      _filllevels: null,\n      // for continuous colorscales: fill with a gradient instead of explicit levels\n      // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n      _fillgradient: null,\n      // when using a gradient, we need the data range specified separately\n      _zrange: null\n    });\n  }\n\n  function calcOpts() {\n    if (typeof cbOpt.calc === 'function') {\n      cbOpt.calc(gd, trace, opts);\n    } else {\n      opts._fillgradient = cont.reversescale ? flipScale(cont.colorscale) : cont.colorscale;\n      opts._zrange = [cont[cbOpt.min], cont[cbOpt.max]];\n    }\n  }\n\n  for (var i = 0; i < calcdata.length; i++) {\n    var cd = calcdata[i];\n    trace = cd[0].trace;\n    var moduleOpts = trace._module.colorbar;\n\n    if (trace.visible === true && moduleOpts) {\n      var allowsMultiplotCbs = Array.isArray(moduleOpts);\n      var cbOpts = allowsMultiplotCbs ? moduleOpts : [moduleOpts];\n\n      for (var j = 0; j < cbOpts.length; j++) {\n        cbOpt = cbOpts[j];\n        var contName = cbOpt.container;\n        cont = contName ? trace[contName] : trace;\n\n        if (cont && cont.showscale) {\n          opts = initOpts(cont.colorbar);\n          opts._id = 'cb' + trace.uid + (allowsMultiplotCbs && contName ? '-' + contName : '');\n          opts._traceIndex = trace.index;\n          opts._propPrefix = (contName ? contName + '.' : '') + 'colorbar.';\n          opts._meta = trace._meta;\n          calcOpts();\n          out.push(opts);\n        }\n      }\n    }\n  }\n\n  for (var k in fullLayout._colorAxes) {\n    cont = fullLayout[k];\n\n    if (cont.showscale) {\n      var colorAxOpts = fullLayout._colorAxes[k];\n      opts = initOpts(cont.colorbar);\n      opts._id = 'cb' + k;\n      opts._propPrefix = k + '.colorbar.';\n      opts._meta = fullLayout._meta;\n      cbOpt = {\n        min: 'cmin',\n        max: 'cmax'\n      };\n\n      if (colorAxOpts[0] !== 'heatmap') {\n        trace = colorAxOpts[1];\n        cbOpt.calc = trace._module.colorbar.calc;\n      }\n\n      calcOpts();\n      out.push(opts);\n    }\n  }\n\n  return out;\n}\n\nfunction drawColorBar(g, opts, gd) {\n  var len = opts.len;\n  var lenmode = opts.lenmode;\n  var thickness = opts.thickness;\n  var thicknessmode = opts.thicknessmode;\n  var outlinewidth = opts.outlinewidth;\n  var borderwidth = opts.borderwidth;\n  var xanchor = opts.xanchor;\n  var yanchor = opts.yanchor;\n  var xpad = opts.xpad;\n  var ypad = opts.ypad;\n  var optsX = opts.x;\n  var optsY = opts.y;\n  var fullLayout = gd._fullLayout;\n  var gs = fullLayout._size;\n  var fillColor = opts._fillcolor;\n  var line = opts._line;\n  var title = opts.title;\n  var titleSide = title.side;\n  var zrange = opts._zrange || d3.extent((typeof fillColor === 'function' ? fillColor : line.color).domain());\n  var lineColormap = typeof line.color === 'function' ? line.color : function () {\n    return line.color;\n  };\n  var fillColormap = typeof fillColor === 'function' ? fillColor : function () {\n    return fillColor;\n  };\n  var levelsIn = opts._levels;\n  var levelsOut = calcLevels(gd, opts, zrange);\n  var fillLevels = levelsOut.fill;\n  var lineLevels = levelsOut.line; // we calculate pixel sizes based on the specified graph size,\n  // not the actual (in case something pushed the margins around)\n  // which is a little odd but avoids an odd iterative effect\n  // when the colorbar itself is pushing the margins.\n  // but then the fractional size is calculated based on the\n  // actual graph size, so that the axes will size correctly.\n\n  var thickPx = Math.round(thickness * (thicknessmode === 'fraction' ? gs.w : 1));\n  var thickFrac = thickPx / gs.w;\n  var lenPx = Math.round(len * (lenmode === 'fraction' ? gs.h : 1));\n  var lenFrac = lenPx / gs.h;\n  var xpadFrac = xpad / gs.w;\n  var yExtraPx = (borderwidth + outlinewidth) / 2;\n  var ypadFrac = ypad / gs.h; // x positioning: do it initially just for left anchor,\n  // then fix at the end (since we don't know the width yet)\n\n  var uPx = Math.round(optsX * gs.w + xpad); // for dragging... this is getting a little muddled...\n\n  var uFrac = optsX - thickFrac * ({\n    center: 0.5,\n    right: 1\n  }[xanchor] || 0); // y positioning we can do correctly from the start\n\n  var vFrac = optsY + lenFrac * (({\n    top: -0.5,\n    bottom: 0.5\n  }[yanchor] || 0) - 0.5);\n  var vPx = Math.round(gs.h * (1 - vFrac)); // stash a few things for makeEditable\n\n  opts._lenFrac = lenFrac;\n  opts._thickFrac = thickFrac;\n  opts._uFrac = uFrac;\n  opts._vFrac = vFrac; // stash mocked axis for contour label formatting\n\n  var ax = opts._axis = mockColorBarAxis(gd, opts, zrange); // position can't go in through supplyDefaults\n  // because that restricts it to [0,1]\n\n  ax.position = optsX + xpadFrac + thickFrac;\n\n  if (['top', 'bottom'].indexOf(titleSide) !== -1) {\n    ax.title.side = titleSide;\n    ax.titlex = optsX + xpadFrac;\n    ax.titley = vFrac + (title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n  }\n\n  if (line.color && opts.tickmode === 'auto') {\n    ax.tickmode = 'linear';\n    ax.tick0 = levelsIn.start;\n    var dtick = levelsIn.size; // expand if too many contours, so we don't get too many ticks\n\n    var autoNtick = Lib.constrain(lenPx / 50, 4, 15) + 1;\n    var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n\n    if (dtFactor > 1) {\n      var dtexp = Math.pow(10, Math.floor(Math.log(dtFactor) / Math.LN10));\n      dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]); // if the contours are at round multiples, reset tick0\n      // so they're still at round multiples. Otherwise,\n      // keep the first label on the first contour level\n\n      if ((Math.abs(levelsIn.start) / levelsIn.size + 1e-6) % 1 < 2e-6) {\n        ax.tick0 = 0;\n      }\n    }\n\n    ax.dtick = dtick;\n  } // set domain after init, because we may want to\n  // allow it outside [0,1]\n\n\n  ax.domain = [vFrac + ypadFrac, vFrac + lenFrac - ypadFrac];\n  ax.setScale();\n  g.attr('transform', strTranslate(Math.round(gs.l), Math.round(gs.t)));\n  var titleCont = g.select('.' + cn.cbtitleunshift).attr('transform', strTranslate(-Math.round(gs.l), -Math.round(gs.t)));\n  var axLayer = g.select('.' + cn.cbaxis);\n  var titleEl;\n  var titleHeight = 0;\n\n  function drawTitle(titleClass, titleOpts) {\n    var dfltTitleOpts = {\n      propContainer: ax,\n      propName: opts._propPrefix + 'title',\n      traceIndex: opts._traceIndex,\n      _meta: opts._meta,\n      placeholder: fullLayout._dfltTitle.colorbar,\n      containerGroup: g.select('.' + cn.cbtitle)\n    }; // this class-to-rotate thing with convertToTspans is\n    // getting hackier and hackier... delete groups with the\n    // wrong class (in case earlier the colorbar was drawn on\n    // a different side, I think?)\n\n    var otherClass = titleClass.charAt(0) === 'h' ? titleClass.substr(1) : 'h' + titleClass;\n    g.selectAll('.' + otherClass + ',.' + otherClass + '-math-group').remove();\n    Titles.draw(gd, titleClass, extendFlat(dfltTitleOpts, titleOpts || {}));\n  }\n\n  function drawDummyTitle() {\n    if (['top', 'bottom'].indexOf(titleSide) !== -1) {\n      // draw the title so we know how much room it needs\n      // when we squish the axis. This one only applies to\n      // top or bottom titles, not right side.\n      var x = gs.l + (optsX + xpadFrac) * gs.w;\n      var fontSize = ax.title.font.size;\n      var y;\n\n      if (titleSide === 'top') {\n        y = (1 - (vFrac + lenFrac - ypadFrac)) * gs.h + gs.t + 3 + fontSize * 0.75;\n      } else {\n        y = (1 - (vFrac + ypadFrac)) * gs.h + gs.t - 3 - fontSize * 0.25;\n      }\n\n      drawTitle(ax._id + 'title', {\n        attributes: {\n          x: x,\n          y: y,\n          'text-anchor': 'start'\n        }\n      });\n    }\n  }\n\n  function drawCbTitle() {\n    if (['top', 'bottom'].indexOf(titleSide) === -1) {\n      var fontSize = ax.title.font.size;\n      var y = ax._offset + ax._length / 2;\n      var x = gs.l + (ax.position || 0) * gs.w + (ax.side === 'right' ? 10 + fontSize * (ax.showticklabels ? 1 : 0.5) : -10 - fontSize * (ax.showticklabels ? 0.5 : 0)); // the 'h' + is a hack to get around the fact that\n      // convertToTspans rotates any 'y...' class by 90 degrees.\n      // TODO: find a better way to control this.\n\n      drawTitle('h' + ax._id + 'title', {\n        avoid: {\n          selection: d3.select(gd).selectAll('g.' + ax._id + 'tick'),\n          side: titleSide,\n          offsetLeft: gs.l,\n          offsetTop: 0,\n          maxShift: fullLayout.width\n        },\n        attributes: {\n          x: x,\n          y: y,\n          'text-anchor': 'middle'\n        },\n        transform: {\n          rotate: '-90',\n          offset: 0\n        }\n      });\n    }\n  }\n\n  function drawAxis() {\n    if (['top', 'bottom'].indexOf(titleSide) !== -1) {\n      // squish the axis top to make room for the title\n      var titleGroup = g.select('.' + cn.cbtitle);\n      var titleText = titleGroup.select('text');\n      var titleTrans = [-outlinewidth / 2, outlinewidth / 2];\n      var mathJaxNode = titleGroup.select('.h' + ax._id + 'title-math-group').node();\n      var lineSize = 15.6;\n\n      if (titleText.node()) {\n        lineSize = parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n      }\n\n      if (mathJaxNode) {\n        titleHeight = Drawing.bBox(mathJaxNode).height;\n\n        if (titleHeight > lineSize) {\n          // not entirely sure how mathjax is doing\n          // vertical alignment, but this seems to work.\n          titleTrans[1] -= (titleHeight - lineSize) / 2;\n        }\n      } else if (titleText.node() && !titleText.classed(cn.jsPlaceholder)) {\n        titleHeight = Drawing.bBox(titleText.node()).height;\n      }\n\n      if (titleHeight) {\n        // buffer btwn colorbar and title\n        // TODO: configurable\n        titleHeight += 5;\n\n        if (titleSide === 'top') {\n          ax.domain[1] -= titleHeight / gs.h;\n          titleTrans[1] *= -1;\n        } else {\n          ax.domain[0] += titleHeight / gs.h;\n          var nlines = svgTextUtils.lineCount(titleText);\n          titleTrans[1] += (1 - nlines) * lineSize;\n        }\n\n        titleGroup.attr('transform', strTranslate(titleTrans[0], titleTrans[1]));\n        ax.setScale();\n      }\n    }\n\n    g.selectAll('.' + cn.cbfills + ',.' + cn.cblines).attr('transform', strTranslate(0, Math.round(gs.h * (1 - ax.domain[1]))));\n    axLayer.attr('transform', strTranslate(0, Math.round(-gs.t)));\n    var fills = g.select('.' + cn.cbfills).selectAll('rect.' + cn.cbfill).attr('style', '').data(fillLevels);\n    fills.enter().append('rect').classed(cn.cbfill, true).style('stroke', 'none');\n    fills.exit().remove();\n    var zBounds = zrange.map(ax.c2p).map(Math.round).sort(function (a, b) {\n      return a - b;\n    });\n    fills.each(function (d, i) {\n      var z = [i === 0 ? zrange[0] : (fillLevels[i] + fillLevels[i - 1]) / 2, i === fillLevels.length - 1 ? zrange[1] : (fillLevels[i] + fillLevels[i + 1]) / 2].map(ax.c2p).map(Math.round); // offset the side adjoining the next rectangle so they\n      // overlap, to prevent antialiasing gaps\n\n      z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]); // Colorbar cannot currently support opacities so we\n      // use an opaque fill even when alpha channels present\n\n      var fillEl = d3.select(this).attr({\n        x: uPx,\n        width: Math.max(thickPx, 2),\n        y: d3.min(z),\n        height: Math.max(d3.max(z) - d3.min(z), 2)\n      });\n\n      if (opts._fillgradient) {\n        Drawing.gradient(fillEl, gd, opts._id, 'vertical', opts._fillgradient, 'fill');\n      } else {\n        // tinycolor can't handle exponents and\n        // at this scale, removing it makes no difference.\n        var colorString = fillColormap(d).replace('e-', '');\n        fillEl.attr('fill', tinycolor(colorString).toHexString());\n      }\n    });\n    var lines = g.select('.' + cn.cblines).selectAll('path.' + cn.cbline).data(line.color && line.width ? lineLevels : []);\n    lines.enter().append('path').classed(cn.cbline, true);\n    lines.exit().remove();\n    lines.each(function (d) {\n      d3.select(this).attr('d', 'M' + uPx + ',' + (Math.round(ax.c2p(d)) + line.width / 2 % 1) + 'h' + thickPx).call(Drawing.lineGroupStyle, line.width, lineColormap(d), line.dash);\n    }); // force full redraw of labels and ticks\n\n    axLayer.selectAll('g.' + ax._id + 'tick,path').remove();\n    var shift = uPx + thickPx + (outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n    var vals = Axes.calcTicks(ax);\n    var tickSign = Axes.getTickSigns(ax)[2];\n    Axes.drawTicks(gd, ax, {\n      vals: ax.ticks === 'inside' ? Axes.clipEnds(ax, vals) : vals,\n      layer: axLayer,\n      path: Axes.makeTickPath(ax, shift, tickSign),\n      transFn: Axes.makeTransTickFn(ax)\n    });\n    return Axes.drawLabels(gd, ax, {\n      vals: vals,\n      layer: axLayer,\n      transFn: Axes.makeTransTickLabelFn(ax),\n      labelFns: Axes.makeLabelFns(ax, shift)\n    });\n  } // wait for the axis & title to finish rendering before\n  // continuing positioning\n  // TODO: why are we redrawing multiple times now with this?\n  // I guess autoMargin doesn't like being post-promise?\n\n\n  function positionCB() {\n    var innerThickness = thickPx + outlinewidth / 2;\n\n    if (ax.ticklabelposition.indexOf('inside') === -1) {\n      innerThickness += Drawing.bBox(axLayer.node()).width;\n    }\n\n    titleEl = titleCont.select('text');\n\n    if (titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n      var mathJaxNode = titleCont.select('.h' + ax._id + 'title-math-group').node();\n      var titleWidth;\n\n      if (mathJaxNode && ['top', 'bottom'].indexOf(titleSide) !== -1) {\n        titleWidth = Drawing.bBox(mathJaxNode).width;\n      } else {\n        // note: the formula below works for all title sides,\n        // (except for top/bottom mathjax, above)\n        // but the weird gs.l is because the titleunshift\n        // transform gets removed by Drawing.bBox\n        titleWidth = Drawing.bBox(titleCont.node()).right - uPx - gs.l;\n      }\n\n      innerThickness = Math.max(innerThickness, titleWidth);\n    }\n\n    var outerThickness = 2 * xpad + innerThickness + borderwidth + outlinewidth / 2;\n    g.select('.' + cn.cbbg).attr({\n      x: uPx - xpad - (borderwidth + outlinewidth) / 2,\n      y: vPx - lenPx - yExtraPx,\n      width: Math.max(outerThickness, 2),\n      height: Math.max(lenPx + 2 * yExtraPx, 2)\n    }).call(Color.fill, opts.bgcolor).call(Color.stroke, opts.bordercolor).style('stroke-width', borderwidth);\n    g.selectAll('.' + cn.cboutline).attr({\n      x: uPx,\n      y: vPx - lenPx + ypad + (titleSide === 'top' ? titleHeight : 0),\n      width: Math.max(thickPx, 2),\n      height: Math.max(lenPx - 2 * ypad - titleHeight, 2)\n    }).call(Color.stroke, opts.outlinecolor).style({\n      fill: 'none',\n      'stroke-width': outlinewidth\n    }); // fix positioning for xanchor!='left'\n\n    var xoffset = ({\n      center: 0.5,\n      right: 1\n    }[xanchor] || 0) * outerThickness;\n    g.attr('transform', strTranslate(gs.l - xoffset, gs.t)); // auto margin adjustment\n\n    var marginOpts = {};\n    var tFrac = FROM_TL[yanchor];\n    var bFrac = FROM_BR[yanchor];\n\n    if (lenmode === 'pixels') {\n      marginOpts.y = optsY;\n      marginOpts.t = lenPx * tFrac;\n      marginOpts.b = lenPx * bFrac;\n    } else {\n      marginOpts.t = marginOpts.b = 0;\n      marginOpts.yt = optsY + len * tFrac;\n      marginOpts.yb = optsY - len * bFrac;\n    }\n\n    var lFrac = FROM_TL[xanchor];\n    var rFrac = FROM_BR[xanchor];\n\n    if (thicknessmode === 'pixels') {\n      marginOpts.x = optsX;\n      marginOpts.l = outerThickness * lFrac;\n      marginOpts.r = outerThickness * rFrac;\n    } else {\n      var extraThickness = outerThickness - thickPx;\n      marginOpts.l = extraThickness * lFrac;\n      marginOpts.r = extraThickness * rFrac;\n      marginOpts.xl = optsX - thickness * lFrac;\n      marginOpts.xr = optsX + thickness * rFrac;\n    }\n\n    Plots.autoMargin(gd, opts._id, marginOpts);\n  }\n\n  return Lib.syncOrAsync([Plots.previousPromises, drawDummyTitle, drawAxis, drawCbTitle, Plots.previousPromises, positionCB], gd);\n}\n\nfunction makeEditable(g, opts, gd) {\n  var fullLayout = gd._fullLayout;\n  var gs = fullLayout._size;\n  var t0, xf, yf;\n  dragElement.init({\n    element: g.node(),\n    gd: gd,\n    prepFn: function () {\n      t0 = g.attr('transform');\n      setCursor(g);\n    },\n    moveFn: function (dx, dy) {\n      g.attr('transform', t0 + strTranslate(dx, dy));\n      xf = dragElement.align(opts._uFrac + dx / gs.w, opts._thickFrac, 0, 1, opts.xanchor);\n      yf = dragElement.align(opts._vFrac - dy / gs.h, opts._lenFrac, 0, 1, opts.yanchor);\n      var csr = dragElement.getCursor(xf, yf, opts.xanchor, opts.yanchor);\n      setCursor(g, csr);\n    },\n    doneFn: function () {\n      setCursor(g);\n\n      if (xf !== undefined && yf !== undefined) {\n        var update = {};\n        update[opts._propPrefix + 'x'] = xf;\n        update[opts._propPrefix + 'y'] = yf;\n\n        if (opts._traceIndex !== undefined) {\n          Registry.call('_guiRestyle', gd, update, opts._traceIndex);\n        } else {\n          Registry.call('_guiRelayout', gd, update);\n        }\n      }\n    }\n  });\n}\n\nfunction calcLevels(gd, opts, zrange) {\n  var levelsIn = opts._levels;\n  var lineLevels = [];\n  var fillLevels = [];\n  var l;\n  var i;\n  var l0 = levelsIn.end + levelsIn.size / 100;\n  var ls = levelsIn.size;\n  var zr0 = 1.001 * zrange[0] - 0.001 * zrange[1];\n  var zr1 = 1.001 * zrange[1] - 0.001 * zrange[0];\n\n  for (i = 0; i < 1e5; i++) {\n    l = levelsIn.start + i * ls;\n    if (ls > 0 ? l >= l0 : l <= l0) break;\n    if (l > zr0 && l < zr1) lineLevels.push(l);\n  }\n\n  if (opts._fillgradient) {\n    fillLevels = [0];\n  } else if (typeof opts._fillcolor === 'function') {\n    var fillLevelsIn = opts._filllevels;\n\n    if (fillLevelsIn) {\n      l0 = fillLevelsIn.end + fillLevelsIn.size / 100;\n      ls = fillLevelsIn.size;\n\n      for (i = 0; i < 1e5; i++) {\n        l = fillLevelsIn.start + i * ls;\n        if (ls > 0 ? l >= l0 : l <= l0) break;\n        if (l > zrange[0] && l < zrange[1]) fillLevels.push(l);\n      }\n    } else {\n      fillLevels = lineLevels.map(function (v) {\n        return v - levelsIn.size / 2;\n      });\n      fillLevels.push(fillLevels[fillLevels.length - 1] + levelsIn.size);\n    }\n  } else if (opts._fillcolor && typeof opts._fillcolor === 'string') {\n    // doesn't matter what this value is, with a single value\n    // we'll make a single fill rect covering the whole bar\n    fillLevels = [0];\n  }\n\n  if (levelsIn.size < 0) {\n    lineLevels.reverse();\n    fillLevels.reverse();\n  }\n\n  return {\n    line: lineLevels,\n    fill: fillLevels\n  };\n}\n\nfunction mockColorBarAxis(gd, opts, zrange) {\n  var fullLayout = gd._fullLayout;\n  var cbAxisIn = {\n    type: 'linear',\n    range: zrange,\n    tickmode: opts.tickmode,\n    nticks: opts.nticks,\n    tick0: opts.tick0,\n    dtick: opts.dtick,\n    tickvals: opts.tickvals,\n    ticktext: opts.ticktext,\n    ticks: opts.ticks,\n    ticklen: opts.ticklen,\n    tickwidth: opts.tickwidth,\n    tickcolor: opts.tickcolor,\n    showticklabels: opts.showticklabels,\n    ticklabelposition: opts.ticklabelposition,\n    ticklabeloverflow: opts.ticklabeloverflow,\n    tickfont: opts.tickfont,\n    tickangle: opts.tickangle,\n    tickformat: opts.tickformat,\n    exponentformat: opts.exponentformat,\n    minexponent: opts.minexponent,\n    separatethousands: opts.separatethousands,\n    showexponent: opts.showexponent,\n    showtickprefix: opts.showtickprefix,\n    tickprefix: opts.tickprefix,\n    showticksuffix: opts.showticksuffix,\n    ticksuffix: opts.ticksuffix,\n    title: opts.title,\n    showline: true,\n    anchor: 'free',\n    side: 'right',\n    position: 1\n  };\n  var cbAxisOut = {\n    type: 'linear',\n    _id: 'y' + opts._id\n  };\n  var axisOptions = {\n    letter: 'y',\n    font: fullLayout.font,\n    noHover: true,\n    noTickson: true,\n    noTicklabelmode: true,\n    calendar: fullLayout.calendar // not really necessary (yet?)\n\n  };\n\n  function coerce(attr, dflt) {\n    return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n  }\n\n  handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n  handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n  return cbAxisOut;\n}\n\nmodule.exports = {\n  draw: draw\n};","map":{"version":3,"sources":["C:/Users/Ajax/Desktop/Praksa/React/REACT-APP-FOR-MLC-main/node_modules/plotly.js/src/components/colorbar/draw.js"],"names":["d3","require","tinycolor","Plots","Registry","Axes","dragElement","Lib","strTranslate","extendFlat","setCursor","Drawing","Color","Titles","svgTextUtils","flipScale","handleAxisDefaults","handleAxisPositionDefaults","axisLayoutAttrs","alignmentConstants","LINE_SPACING","FROM_TL","FROM_BR","cn","draw","gd","fullLayout","_fullLayout","colorBars","_infolayer","selectAll","colorbar","data","makeColorBarData","opts","_id","enter","append","attr","classed","each","g","select","ensureSingle","cbbg","cbfills","cblines","cbaxis","s","crisp","cbtitleunshift","cbtitle","cboutline","done","drawColorBar","then","_promises","push","_context","edits","colorbarPosition","makeEditable","exit","autoMargin","remove","order","calcdata","out","cont","trace","cbOpt","initOpts","_fillcolor","_line","color","width","dash","_levels","start","end","size","_filllevels","_fillgradient","_zrange","calcOpts","calc","reversescale","colorscale","min","max","i","length","cd","moduleOpts","_module","visible","allowsMultiplotCbs","Array","isArray","cbOpts","j","contName","container","showscale","uid","_traceIndex","index","_propPrefix","_meta","k","_colorAxes","colorAxOpts","len","lenmode","thickness","thicknessmode","outlinewidth","borderwidth","xanchor","yanchor","xpad","ypad","optsX","x","optsY","y","gs","_size","fillColor","line","title","titleSide","side","zrange","extent","domain","lineColormap","fillColormap","levelsIn","levelsOut","calcLevels","fillLevels","fill","lineLevels","thickPx","Math","round","w","thickFrac","lenPx","h","lenFrac","xpadFrac","yExtraPx","ypadFrac","uPx","uFrac","center","right","vFrac","top","bottom","vPx","_lenFrac","_thickFrac","_uFrac","_vFrac","ax","_axis","mockColorBarAxis","position","indexOf","titlex","titley","tickmode","tick0","dtick","autoNtick","constrain","dtFactor","nticks","dtexp","pow","floor","log","LN10","roundUp","abs","setScale","l","t","titleCont","axLayer","titleEl","titleHeight","drawTitle","titleClass","titleOpts","dfltTitleOpts","propContainer","propName","traceIndex","placeholder","_dfltTitle","containerGroup","otherClass","charAt","substr","drawDummyTitle","fontSize","font","attributes","drawCbTitle","_offset","_length","showticklabels","avoid","selection","offsetLeft","offsetTop","maxShift","transform","rotate","offset","drawAxis","titleGroup","titleText","titleTrans","mathJaxNode","node","lineSize","parseInt","style","bBox","height","jsPlaceholder","nlines","lineCount","fills","cbfill","zBounds","map","c2p","sort","a","b","d","z","fillEl","gradient","colorString","replace","toHexString","lines","cbline","call","lineGroupStyle","shift","ticks","vals","calcTicks","tickSign","getTickSigns","drawTicks","clipEnds","layer","path","makeTickPath","transFn","makeTransTickFn","drawLabels","makeTransTickLabelFn","labelFns","makeLabelFns","positionCB","innerThickness","ticklabelposition","titleWidth","outerThickness","bgcolor","stroke","bordercolor","outlinecolor","xoffset","marginOpts","tFrac","bFrac","yt","yb","lFrac","rFrac","r","extraThickness","xl","xr","syncOrAsync","previousPromises","t0","xf","yf","init","element","prepFn","moveFn","dx","dy","align","csr","getCursor","doneFn","undefined","update","l0","ls","zr0","zr1","fillLevelsIn","v","reverse","cbAxisIn","type","range","tickvals","ticktext","ticklen","tickwidth","tickcolor","ticklabeloverflow","tickfont","tickangle","tickformat","exponentformat","minexponent","separatethousands","showexponent","showtickprefix","tickprefix","showticksuffix","ticksuffix","showline","anchor","cbAxisOut","axisOptions","letter","noHover","noTickson","noTicklabelmode","calendar","coerce","dflt","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,EAAE,GAAGC,OAAO,CAAC,YAAD,CAAhB;;AACA,IAAIC,SAAS,GAAGD,OAAO,CAAC,YAAD,CAAvB;;AAEA,IAAIE,KAAK,GAAGF,OAAO,CAAC,mBAAD,CAAnB;;AACA,IAAIG,QAAQ,GAAGH,OAAO,CAAC,gBAAD,CAAtB;;AACA,IAAII,IAAI,GAAGJ,OAAO,CAAC,4BAAD,CAAlB;;AACA,IAAIK,WAAW,GAAGL,OAAO,CAAC,gBAAD,CAAzB;;AACA,IAAIM,GAAG,GAAGN,OAAO,CAAC,WAAD,CAAjB;;AACA,IAAIO,YAAY,GAAGD,GAAG,CAACC,YAAvB;;AACA,IAAIC,UAAU,GAAGR,OAAO,CAAC,kBAAD,CAAP,CAA4BQ,UAA7C;;AACA,IAAIC,SAAS,GAAGT,OAAO,CAAC,qBAAD,CAAvB;;AACA,IAAIU,OAAO,GAAGV,OAAO,CAAC,YAAD,CAArB;;AACA,IAAIW,KAAK,GAAGX,OAAO,CAAC,UAAD,CAAnB;;AACA,IAAIY,MAAM,GAAGZ,OAAO,CAAC,WAAD,CAApB;;AACA,IAAIa,YAAY,GAAGb,OAAO,CAAC,0BAAD,CAA1B;;AACA,IAAIc,SAAS,GAAGd,OAAO,CAAC,uBAAD,CAAP,CAAiCc,SAAjD;;AAEA,IAAIC,kBAAkB,GAAGf,OAAO,CAAC,qCAAD,CAAhC;;AACA,IAAIgB,0BAA0B,GAAGhB,OAAO,CAAC,yCAAD,CAAxC;;AACA,IAAIiB,eAAe,GAAGjB,OAAO,CAAC,yCAAD,CAA7B;;AAEA,IAAIkB,kBAAkB,GAAGlB,OAAO,CAAC,2BAAD,CAAhC;;AACA,IAAImB,YAAY,GAAGD,kBAAkB,CAACC,YAAtC;AACA,IAAIC,OAAO,GAAGF,kBAAkB,CAACE,OAAjC;AACA,IAAIC,OAAO,GAAGH,kBAAkB,CAACG,OAAjC;;AAEA,IAAIC,EAAE,GAAGtB,OAAO,CAAC,aAAD,CAAP,CAAuBsB,EAAhC;;AAEA,SAASC,IAAT,CAAcC,EAAd,EAAkB;AACd,MAAIC,UAAU,GAAGD,EAAE,CAACE,WAApB;;AAEA,MAAIC,SAAS,GAAGF,UAAU,CAACG,UAAX,CACXC,SADW,CACD,OAAOP,EAAE,CAACQ,QADT,EAEXC,IAFW,CAENC,gBAAgB,CAACR,EAAD,CAFV,EAEgB,UAASS,IAAT,EAAe;AAAE,WAAOA,IAAI,CAACC,GAAZ;AAAkB,GAFnD,CAAhB;;AAIAP,EAAAA,SAAS,CAACQ,KAAV,GAAkBC,MAAlB,CAAyB,GAAzB,EACKC,IADL,CACU,OADV,EACmB,UAASJ,IAAT,EAAe;AAAE,WAAOA,IAAI,CAACC,GAAZ;AAAkB,GADtD,EAEKI,OAFL,CAEahB,EAAE,CAACQ,QAFhB,EAE0B,IAF1B;AAIAH,EAAAA,SAAS,CAACY,IAAV,CAAe,UAASN,IAAT,EAAe;AAC1B,QAAIO,CAAC,GAAGzC,EAAE,CAAC0C,MAAH,CAAU,IAAV,CAAR;AAEAnC,IAAAA,GAAG,CAACoC,YAAJ,CAAiBF,CAAjB,EAAoB,MAApB,EAA4BlB,EAAE,CAACqB,IAA/B;AACArC,IAAAA,GAAG,CAACoC,YAAJ,CAAiBF,CAAjB,EAAoB,GAApB,EAAyBlB,EAAE,CAACsB,OAA5B;AACAtC,IAAAA,GAAG,CAACoC,YAAJ,CAAiBF,CAAjB,EAAoB,GAApB,EAAyBlB,EAAE,CAACuB,OAA5B;AACAvC,IAAAA,GAAG,CAACoC,YAAJ,CAAiBF,CAAjB,EAAoB,GAApB,EAAyBlB,EAAE,CAACwB,MAA5B,EAAoC,UAASC,CAAT,EAAY;AAAEA,MAAAA,CAAC,CAACT,OAAF,CAAUhB,EAAE,CAAC0B,KAAb,EAAoB,IAApB;AAA4B,KAA9E;AACA1C,IAAAA,GAAG,CAACoC,YAAJ,CAAiBF,CAAjB,EAAoB,GAApB,EAAyBlB,EAAE,CAAC2B,cAA5B,EAA4C,UAASF,CAAT,EAAY;AAAEA,MAAAA,CAAC,CAACX,MAAF,CAAS,GAAT,EAAcE,OAAd,CAAsBhB,EAAE,CAAC4B,OAAzB,EAAkC,IAAlC;AAA0C,KAApG;AACA5C,IAAAA,GAAG,CAACoC,YAAJ,CAAiBF,CAAjB,EAAoB,MAApB,EAA4BlB,EAAE,CAAC6B,SAA/B;AAEA,QAAIC,IAAI,GAAGC,YAAY,CAACb,CAAD,EAAIP,IAAJ,EAAUT,EAAV,CAAvB;AACA,QAAG4B,IAAI,IAAIA,IAAI,CAACE,IAAhB,EAAsB,CAAC9B,EAAE,CAAC+B,SAAH,IAAgB,EAAjB,EAAqBC,IAArB,CAA0BJ,IAA1B;;AAEtB,QAAG5B,EAAE,CAACiC,QAAH,CAAYC,KAAZ,CAAkBC,gBAArB,EAAuC;AACnCC,MAAAA,YAAY,CAACpB,CAAD,EAAIP,IAAJ,EAAUT,EAAV,CAAZ;AACH;AACJ,GAhBD;AAkBAG,EAAAA,SAAS,CAACkC,IAAV,GACKtB,IADL,CACU,UAASN,IAAT,EAAe;AAAE/B,IAAAA,KAAK,CAAC4D,UAAN,CAAiBtC,EAAjB,EAAqBS,IAAI,CAACC,GAA1B;AAAiC,GAD5D,EAEK6B,MAFL;AAIApC,EAAAA,SAAS,CAACqC,KAAV;AACH;;AAED,SAAShC,gBAAT,CAA0BR,EAA1B,EAA8B;AAC1B,MAAIC,UAAU,GAAGD,EAAE,CAACE,WAApB;AACA,MAAIuC,QAAQ,GAAGzC,EAAE,CAACyC,QAAlB;AACA,MAAIC,GAAG,GAAG,EAAV,CAH0B,CAK1B;;AACA,MAAIjC,IAAJ,CAN0B,CAO1B;;AACA,MAAIkC,IAAJ,CAR0B,CAS1B;;AACA,MAAIC,KAAJ,CAV0B,CAW1B;;AACA,MAAIC,KAAJ;;AAEA,WAASC,QAAT,CAAkBrC,IAAlB,EAAwB;AACpB,WAAOzB,UAAU,CAACyB,IAAD,EAAO;AACpB;AACA;AACA;AACAsC,MAAAA,UAAU,EAAE,IAJQ;AAKpB;AACAC,MAAAA,KAAK,EAAE;AAACC,QAAAA,KAAK,EAAE,IAAR;AAAcC,QAAAA,KAAK,EAAE,IAArB;AAA2BC,QAAAA,IAAI,EAAE;AAAjC,OANa;AAOpB;AACA;AACA;AACA;AACAC,MAAAA,OAAO,EAAE;AAACC,QAAAA,KAAK,EAAE,IAAR;AAAcC,QAAAA,GAAG,EAAE,IAAnB;AAAyBC,QAAAA,IAAI,EAAE;AAA/B,OAXW;AAYpB;AACA;AACA;AACAC,MAAAA,WAAW,EAAE,IAfO;AAgBpB;AACA;AACAC,MAAAA,aAAa,EAAE,IAlBK;AAmBpB;AACAC,MAAAA,OAAO,EAAE;AApBW,KAAP,CAAjB;AAsBH;;AAED,WAASC,QAAT,GAAoB;AAChB,QAAG,OAAOd,KAAK,CAACe,IAAb,KAAsB,UAAzB,EAAqC;AACjCf,MAAAA,KAAK,CAACe,IAAN,CAAW5D,EAAX,EAAe4C,KAAf,EAAsBnC,IAAtB;AACH,KAFD,MAEO;AACHA,MAAAA,IAAI,CAACgD,aAAL,GAAqBd,IAAI,CAACkB,YAAL,GACjBvE,SAAS,CAACqD,IAAI,CAACmB,UAAN,CADQ,GAEjBnB,IAAI,CAACmB,UAFT;AAGArD,MAAAA,IAAI,CAACiD,OAAL,GAAe,CAACf,IAAI,CAACE,KAAK,CAACkB,GAAP,CAAL,EAAkBpB,IAAI,CAACE,KAAK,CAACmB,GAAP,CAAtB,CAAf;AACH;AACJ;;AAED,OAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGxB,QAAQ,CAACyB,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,QAAIE,EAAE,GAAG1B,QAAQ,CAACwB,CAAD,CAAjB;AACArB,IAAAA,KAAK,GAAGuB,EAAE,CAAC,CAAD,CAAF,CAAMvB,KAAd;AACA,QAAIwB,UAAU,GAAGxB,KAAK,CAACyB,OAAN,CAAc/D,QAA/B;;AAEA,QAAGsC,KAAK,CAAC0B,OAAN,KAAkB,IAAlB,IAA0BF,UAA7B,EAAyC;AACrC,UAAIG,kBAAkB,GAAGC,KAAK,CAACC,OAAN,CAAcL,UAAd,CAAzB;AACA,UAAIM,MAAM,GAAGH,kBAAkB,GAAGH,UAAH,GAAgB,CAACA,UAAD,CAA/C;;AAEA,WAAI,IAAIO,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGD,MAAM,CAACR,MAA1B,EAAkCS,CAAC,EAAnC,EAAuC;AACnC9B,QAAAA,KAAK,GAAG6B,MAAM,CAACC,CAAD,CAAd;AACA,YAAIC,QAAQ,GAAG/B,KAAK,CAACgC,SAArB;AACAlC,QAAAA,IAAI,GAAGiC,QAAQ,GAAGhC,KAAK,CAACgC,QAAD,CAAR,GAAqBhC,KAApC;;AAEA,YAAGD,IAAI,IAAIA,IAAI,CAACmC,SAAhB,EAA2B;AACvBrE,UAAAA,IAAI,GAAGqC,QAAQ,CAACH,IAAI,CAACrC,QAAN,CAAf;AACAG,UAAAA,IAAI,CAACC,GAAL,GAAW,OAAOkC,KAAK,CAACmC,GAAb,IAAoBR,kBAAkB,IAAIK,QAAtB,GAAiC,MAAMA,QAAvC,GAAkD,EAAtE,CAAX;AACAnE,UAAAA,IAAI,CAACuE,WAAL,GAAmBpC,KAAK,CAACqC,KAAzB;AACAxE,UAAAA,IAAI,CAACyE,WAAL,GAAmB,CAACN,QAAQ,GAAGA,QAAQ,GAAG,GAAd,GAAoB,EAA7B,IAAmC,WAAtD;AACAnE,UAAAA,IAAI,CAAC0E,KAAL,GAAavC,KAAK,CAACuC,KAAnB;AACAxB,UAAAA,QAAQ;AACRjB,UAAAA,GAAG,CAACV,IAAJ,CAASvB,IAAT;AACH;AACJ;AACJ;AACJ;;AAED,OAAI,IAAI2E,CAAR,IAAanF,UAAU,CAACoF,UAAxB,EAAoC;AAChC1C,IAAAA,IAAI,GAAG1C,UAAU,CAACmF,CAAD,CAAjB;;AAEA,QAAGzC,IAAI,CAACmC,SAAR,EAAmB;AACf,UAAIQ,WAAW,GAAGrF,UAAU,CAACoF,UAAX,CAAsBD,CAAtB,CAAlB;AAEA3E,MAAAA,IAAI,GAAGqC,QAAQ,CAACH,IAAI,CAACrC,QAAN,CAAf;AACAG,MAAAA,IAAI,CAACC,GAAL,GAAW,OAAO0E,CAAlB;AACA3E,MAAAA,IAAI,CAACyE,WAAL,GAAmBE,CAAC,GAAG,YAAvB;AACA3E,MAAAA,IAAI,CAAC0E,KAAL,GAAalF,UAAU,CAACkF,KAAxB;AAEAtC,MAAAA,KAAK,GAAG;AAACkB,QAAAA,GAAG,EAAE,MAAN;AAAcC,QAAAA,GAAG,EAAE;AAAnB,OAAR;;AACA,UAAGsB,WAAW,CAAC,CAAD,CAAX,KAAmB,SAAtB,EAAiC;AAC7B1C,QAAAA,KAAK,GAAG0C,WAAW,CAAC,CAAD,CAAnB;AACAzC,QAAAA,KAAK,CAACe,IAAN,GAAahB,KAAK,CAACyB,OAAN,CAAc/D,QAAd,CAAuBsD,IAApC;AACH;;AAEDD,MAAAA,QAAQ;AACRjB,MAAAA,GAAG,CAACV,IAAJ,CAASvB,IAAT;AACH;AACJ;;AAED,SAAOiC,GAAP;AACH;;AAED,SAASb,YAAT,CAAsBb,CAAtB,EAAyBP,IAAzB,EAA+BT,EAA/B,EAAmC;AAC/B,MAAIuF,GAAG,GAAG9E,IAAI,CAAC8E,GAAf;AACA,MAAIC,OAAO,GAAG/E,IAAI,CAAC+E,OAAnB;AACA,MAAIC,SAAS,GAAGhF,IAAI,CAACgF,SAArB;AACA,MAAIC,aAAa,GAAGjF,IAAI,CAACiF,aAAzB;AACA,MAAIC,YAAY,GAAGlF,IAAI,CAACkF,YAAxB;AACA,MAAIC,WAAW,GAAGnF,IAAI,CAACmF,WAAvB;AACA,MAAIC,OAAO,GAAGpF,IAAI,CAACoF,OAAnB;AACA,MAAIC,OAAO,GAAGrF,IAAI,CAACqF,OAAnB;AACA,MAAIC,IAAI,GAAGtF,IAAI,CAACsF,IAAhB;AACA,MAAIC,IAAI,GAAGvF,IAAI,CAACuF,IAAhB;AACA,MAAIC,KAAK,GAAGxF,IAAI,CAACyF,CAAjB;AACA,MAAIC,KAAK,GAAG1F,IAAI,CAAC2F,CAAjB;AAEA,MAAInG,UAAU,GAAGD,EAAE,CAACE,WAApB;AACA,MAAImG,EAAE,GAAGpG,UAAU,CAACqG,KAApB;AAEA,MAAIC,SAAS,GAAG9F,IAAI,CAACsC,UAArB;AACA,MAAIyD,IAAI,GAAG/F,IAAI,CAACuC,KAAhB;AACA,MAAIyD,KAAK,GAAGhG,IAAI,CAACgG,KAAjB;AACA,MAAIC,SAAS,GAAGD,KAAK,CAACE,IAAtB;AAEA,MAAIC,MAAM,GAAGnG,IAAI,CAACiD,OAAL,IACTnF,EAAE,CAACsI,MAAH,CAAU,CAAC,OAAON,SAAP,KAAqB,UAArB,GAAkCA,SAAlC,GAA8CC,IAAI,CAACvD,KAApD,EAA2D6D,MAA3D,EAAV,CADJ;AAGA,MAAIC,YAAY,GAAG,OAAOP,IAAI,CAACvD,KAAZ,KAAsB,UAAtB,GACfuD,IAAI,CAACvD,KADU,GAEf,YAAW;AAAE,WAAOuD,IAAI,CAACvD,KAAZ;AAAoB,GAFrC;AAGA,MAAI+D,YAAY,GAAG,OAAOT,SAAP,KAAqB,UAArB,GACfA,SADe,GAEf,YAAW;AAAE,WAAOA,SAAP;AAAmB,GAFpC;AAIA,MAAIU,QAAQ,GAAGxG,IAAI,CAAC2C,OAApB;AACA,MAAI8D,SAAS,GAAGC,UAAU,CAACnH,EAAD,EAAKS,IAAL,EAAWmG,MAAX,CAA1B;AACA,MAAIQ,UAAU,GAAGF,SAAS,CAACG,IAA3B;AACA,MAAIC,UAAU,GAAGJ,SAAS,CAACV,IAA3B,CAnC+B,CAqC/B;AACA;AACA;AACA;AACA;AACA;;AACA,MAAIe,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWhC,SAAS,IAAIC,aAAa,KAAK,UAAlB,GAA+BW,EAAE,CAACqB,CAAlC,GAAsC,CAA1C,CAApB,CAAd;AACA,MAAIC,SAAS,GAAGJ,OAAO,GAAGlB,EAAE,CAACqB,CAA7B;AACA,MAAIE,KAAK,GAAGJ,IAAI,CAACC,KAAL,CAAWlC,GAAG,IAAIC,OAAO,KAAK,UAAZ,GAAyBa,EAAE,CAACwB,CAA5B,GAAgC,CAApC,CAAd,CAAZ;AACA,MAAIC,OAAO,GAAGF,KAAK,GAAGvB,EAAE,CAACwB,CAAzB;AACA,MAAIE,QAAQ,GAAGhC,IAAI,GAAGM,EAAE,CAACqB,CAAzB;AACA,MAAIM,QAAQ,GAAG,CAACpC,WAAW,GAAGD,YAAf,IAA+B,CAA9C;AACA,MAAIsC,QAAQ,GAAGjC,IAAI,GAAGK,EAAE,CAACwB,CAAzB,CAjD+B,CAmD/B;AACA;;AACA,MAAIK,GAAG,GAAGV,IAAI,CAACC,KAAL,CAAWxB,KAAK,GAAGI,EAAE,CAACqB,CAAX,GAAe3B,IAA1B,CAAV,CArD+B,CAsD/B;;AACA,MAAIoC,KAAK,GAAGlC,KAAK,GAAG0B,SAAS,IAAI;AAACS,IAAAA,MAAM,EAAE,GAAT;AAAcC,IAAAA,KAAK,EAAE;AAArB,IAAwBxC,OAAxB,KAAoC,CAAxC,CAA7B,CAvD+B,CAyD/B;;AACA,MAAIyC,KAAK,GAAGnC,KAAK,GAAG2B,OAAO,IAAI,CAAC;AAACS,IAAAA,GAAG,EAAE,CAAC,GAAP;AAAYC,IAAAA,MAAM,EAAE;AAApB,IAAyB1C,OAAzB,KAAqC,CAAtC,IAA2C,GAA/C,CAA3B;AACA,MAAI2C,GAAG,GAAGjB,IAAI,CAACC,KAAL,CAAWpB,EAAE,CAACwB,CAAH,IAAQ,IAAIS,KAAZ,CAAX,CAAV,CA3D+B,CA6D/B;;AACA7H,EAAAA,IAAI,CAACiI,QAAL,GAAgBZ,OAAhB;AACArH,EAAAA,IAAI,CAACkI,UAAL,GAAkBhB,SAAlB;AACAlH,EAAAA,IAAI,CAACmI,MAAL,GAAcT,KAAd;AACA1H,EAAAA,IAAI,CAACoI,MAAL,GAAcP,KAAd,CAjE+B,CAmE/B;;AACA,MAAIQ,EAAE,GAAGrI,IAAI,CAACsI,KAAL,GAAaC,gBAAgB,CAAChJ,EAAD,EAAKS,IAAL,EAAWmG,MAAX,CAAtC,CApE+B,CAsE/B;AACA;;AACAkC,EAAAA,EAAE,CAACG,QAAH,GAAchD,KAAK,GAAG8B,QAAR,GAAmBJ,SAAjC;;AAEA,MAAG,CAAC,KAAD,EAAQ,QAAR,EAAkBuB,OAAlB,CAA0BxC,SAA1B,MAAyC,CAAC,CAA7C,EAAgD;AAC5CoC,IAAAA,EAAE,CAACrC,KAAH,CAASE,IAAT,GAAgBD,SAAhB;AACAoC,IAAAA,EAAE,CAACK,MAAH,GAAYlD,KAAK,GAAG8B,QAApB;AACAe,IAAAA,EAAE,CAACM,MAAH,GAAYd,KAAK,IAAI7B,KAAK,CAACE,IAAN,KAAe,KAAf,GAAuBmB,OAAO,GAAGG,QAAjC,GAA4CA,QAAhD,CAAjB;AACH;;AAED,MAAGzB,IAAI,CAACvD,KAAL,IAAcxC,IAAI,CAAC4I,QAAL,KAAkB,MAAnC,EAA2C;AACvCP,IAAAA,EAAE,CAACO,QAAH,GAAc,QAAd;AACAP,IAAAA,EAAE,CAACQ,KAAH,GAAWrC,QAAQ,CAAC5D,KAApB;AACA,QAAIkG,KAAK,GAAGtC,QAAQ,CAAC1D,IAArB,CAHuC,CAIvC;;AACA,QAAIiG,SAAS,GAAG1K,GAAG,CAAC2K,SAAJ,CAAc7B,KAAK,GAAG,EAAtB,EAA0B,CAA1B,EAA6B,EAA7B,IAAmC,CAAnD;AACA,QAAI8B,QAAQ,GAAG,CAAC9C,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAnB,KAA2B,CAACnG,IAAI,CAACkJ,MAAL,IAAeH,SAAhB,IAA6BD,KAAxD,CAAf;;AACA,QAAGG,QAAQ,GAAG,CAAd,EAAiB;AACb,UAAIE,KAAK,GAAGpC,IAAI,CAACqC,GAAL,CAAS,EAAT,EAAarC,IAAI,CAACsC,KAAL,CAAWtC,IAAI,CAACuC,GAAL,CAASL,QAAT,IAAqBlC,IAAI,CAACwC,IAArC,CAAb,CAAZ;AACAT,MAAAA,KAAK,IAAIK,KAAK,GAAG9K,GAAG,CAACmL,OAAJ,CAAYP,QAAQ,GAAGE,KAAvB,EAA8B,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,CAA9B,CAAjB,CAFa,CAGb;AACA;AACA;;AACA,UAAG,CAACpC,IAAI,CAAC0C,GAAL,CAASjD,QAAQ,CAAC5D,KAAlB,IAA2B4D,QAAQ,CAAC1D,IAApC,GAA2C,IAA5C,IAAoD,CAApD,GAAwD,IAA3D,EAAiE;AAC7DuF,QAAAA,EAAE,CAACQ,KAAH,GAAW,CAAX;AACH;AACJ;;AACDR,IAAAA,EAAE,CAACS,KAAH,GAAWA,KAAX;AACH,GAlG8B,CAoG/B;AACA;;;AACAT,EAAAA,EAAE,CAAChC,MAAH,GAAY,CACRwB,KAAK,GAAGL,QADA,EAERK,KAAK,GAAGR,OAAR,GAAkBG,QAFV,CAAZ;AAKAa,EAAAA,EAAE,CAACqB,QAAH;AAEAnJ,EAAAA,CAAC,CAACH,IAAF,CAAO,WAAP,EAAoB9B,YAAY,CAACyI,IAAI,CAACC,KAAL,CAAWpB,EAAE,CAAC+D,CAAd,CAAD,EAAmB5C,IAAI,CAACC,KAAL,CAAWpB,EAAE,CAACgE,CAAd,CAAnB,CAAhC;AAEA,MAAIC,SAAS,GAAGtJ,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAAC2B,cAAlB,EACXZ,IADW,CACN,WADM,EACO9B,YAAY,CAAC,CAACyI,IAAI,CAACC,KAAL,CAAWpB,EAAE,CAAC+D,CAAd,CAAF,EAAoB,CAAC5C,IAAI,CAACC,KAAL,CAAWpB,EAAE,CAACgE,CAAd,CAArB,CADnB,CAAhB;AAGA,MAAIE,OAAO,GAAGvJ,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAACwB,MAAlB,CAAd;AACA,MAAIkJ,OAAJ;AACA,MAAIC,WAAW,GAAG,CAAlB;;AAEA,WAASC,SAAT,CAAmBC,UAAnB,EAA+BC,SAA/B,EAA0C;AACtC,QAAIC,aAAa,GAAG;AAChBC,MAAAA,aAAa,EAAEhC,EADC;AAEhBiC,MAAAA,QAAQ,EAAEtK,IAAI,CAACyE,WAAL,GAAmB,OAFb;AAGhB8F,MAAAA,UAAU,EAAEvK,IAAI,CAACuE,WAHD;AAIhBG,MAAAA,KAAK,EAAE1E,IAAI,CAAC0E,KAJI;AAKhB8F,MAAAA,WAAW,EAAEhL,UAAU,CAACiL,UAAX,CAAsB5K,QALnB;AAMhB6K,MAAAA,cAAc,EAAEnK,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAAC4B,OAAlB;AANA,KAApB,CADsC,CAUtC;AACA;AACA;AACA;;AACA,QAAI0J,UAAU,GAAGT,UAAU,CAACU,MAAX,CAAkB,CAAlB,MAAyB,GAAzB,GACbV,UAAU,CAACW,MAAX,CAAkB,CAAlB,CADa,GAEb,MAAMX,UAFV;AAGA3J,IAAAA,CAAC,CAACX,SAAF,CAAY,MAAM+K,UAAN,GAAmB,IAAnB,GAA0BA,UAA1B,GAAuC,aAAnD,EAAkE7I,MAAlE;AAEAnD,IAAAA,MAAM,CAACW,IAAP,CAAYC,EAAZ,EAAgB2K,UAAhB,EAA4B3L,UAAU,CAAC6L,aAAD,EAAgBD,SAAS,IAAI,EAA7B,CAAtC;AACH;;AAED,WAASW,cAAT,GAA0B;AACtB,QAAG,CAAC,KAAD,EAAQ,QAAR,EAAkBrC,OAAlB,CAA0BxC,SAA1B,MAAyC,CAAC,CAA7C,EAAgD;AAC5C;AACA;AACA;AACA,UAAIR,CAAC,GAAGG,EAAE,CAAC+D,CAAH,GAAO,CAACnE,KAAK,GAAG8B,QAAT,IAAqB1B,EAAE,CAACqB,CAAvC;AACA,UAAI8D,QAAQ,GAAG1C,EAAE,CAACrC,KAAH,CAASgF,IAAT,CAAclI,IAA7B;AACA,UAAI6C,CAAJ;;AAEA,UAAGM,SAAS,KAAK,KAAjB,EAAwB;AACpBN,QAAAA,CAAC,GAAG,CAAC,KAAKkC,KAAK,GAAGR,OAAR,GAAkBG,QAAvB,CAAD,IAAqC5B,EAAE,CAACwB,CAAxC,GACAxB,EAAE,CAACgE,CADH,GACO,CADP,GACWmB,QAAQ,GAAG,IAD1B;AAEH,OAHD,MAGO;AACHpF,QAAAA,CAAC,GAAG,CAAC,KAAKkC,KAAK,GAAGL,QAAb,CAAD,IAA2B5B,EAAE,CAACwB,CAA9B,GACAxB,EAAE,CAACgE,CADH,GACO,CADP,GACWmB,QAAQ,GAAG,IAD1B;AAEH;;AACDd,MAAAA,SAAS,CAAC5B,EAAE,CAACpI,GAAH,GAAS,OAAV,EAAmB;AACxBgL,QAAAA,UAAU,EAAE;AAACxF,UAAAA,CAAC,EAAEA,CAAJ;AAAOE,UAAAA,CAAC,EAAEA,CAAV;AAAa,yBAAe;AAA5B;AADY,OAAnB,CAAT;AAGH;AACJ;;AAED,WAASuF,WAAT,GAAuB;AACnB,QAAG,CAAC,KAAD,EAAQ,QAAR,EAAkBzC,OAAlB,CAA0BxC,SAA1B,MAAyC,CAAC,CAA7C,EAAgD;AAC5C,UAAI8E,QAAQ,GAAG1C,EAAE,CAACrC,KAAH,CAASgF,IAAT,CAAclI,IAA7B;AACA,UAAI6C,CAAC,GAAG0C,EAAE,CAAC8C,OAAH,GAAa9C,EAAE,CAAC+C,OAAH,GAAa,CAAlC;AACA,UAAI3F,CAAC,GAAGG,EAAE,CAAC+D,CAAH,GAAO,CAACtB,EAAE,CAACG,QAAH,IAAe,CAAhB,IAAqB5C,EAAE,CAACqB,CAA/B,IAAqCoB,EAAE,CAACnC,IAAH,KAAY,OAAb,GACxC,KAAK6E,QAAQ,IAAK1C,EAAE,CAACgD,cAAH,GAAoB,CAApB,GAAwB,GAA7B,CAD2B,GAExC,CAAC,EAAD,GAAMN,QAAQ,IAAK1C,EAAE,CAACgD,cAAH,GAAoB,GAApB,GAA0B,CAA/B,CAFV,CAAR,CAH4C,CAO5C;AACA;AACA;;AACApB,MAAAA,SAAS,CAAC,MAAM5B,EAAE,CAACpI,GAAT,GAAe,OAAhB,EAAyB;AAC9BqL,QAAAA,KAAK,EAAE;AACHC,UAAAA,SAAS,EAAEzN,EAAE,CAAC0C,MAAH,CAAUjB,EAAV,EAAcK,SAAd,CAAwB,OAAOyI,EAAE,CAACpI,GAAV,GAAgB,MAAxC,CADR;AAEHiG,UAAAA,IAAI,EAAED,SAFH;AAGHuF,UAAAA,UAAU,EAAE5F,EAAE,CAAC+D,CAHZ;AAIH8B,UAAAA,SAAS,EAAE,CAJR;AAKHC,UAAAA,QAAQ,EAAElM,UAAU,CAACiD;AALlB,SADuB;AAQ9BwI,QAAAA,UAAU,EAAE;AAACxF,UAAAA,CAAC,EAAEA,CAAJ;AAAOE,UAAAA,CAAC,EAAEA,CAAV;AAAa,yBAAe;AAA5B,SARkB;AAS9BgG,QAAAA,SAAS,EAAE;AAACC,UAAAA,MAAM,EAAE,KAAT;AAAgBC,UAAAA,MAAM,EAAE;AAAxB;AATmB,OAAzB,CAAT;AAWH;AACJ;;AAED,WAASC,QAAT,GAAoB;AAChB,QAAG,CAAC,KAAD,EAAQ,QAAR,EAAkBrD,OAAlB,CAA0BxC,SAA1B,MAAyC,CAAC,CAA7C,EAAgD;AAC5C;AACA,UAAI8F,UAAU,GAAGxL,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAAC4B,OAAlB,CAAjB;AACA,UAAI+K,SAAS,GAAGD,UAAU,CAACvL,MAAX,CAAkB,MAAlB,CAAhB;AACA,UAAIyL,UAAU,GAAG,CAAC,CAAC/G,YAAD,GAAgB,CAAjB,EAAoBA,YAAY,GAAG,CAAnC,CAAjB;AACA,UAAIgH,WAAW,GAAGH,UAAU,CACvBvL,MADa,CACN,OAAO6H,EAAE,CAACpI,GAAV,GAAgB,kBADV,EAEbkM,IAFa,EAAlB;AAGA,UAAIC,QAAQ,GAAG,IAAf;;AACA,UAAGJ,SAAS,CAACG,IAAV,EAAH,EAAqB;AACjBC,QAAAA,QAAQ,GAAGC,QAAQ,CAACL,SAAS,CAACG,IAAV,GAAiBG,KAAjB,CAAuBvB,QAAxB,EAAkC,EAAlC,CAAR,GAAgD7L,YAA3D;AACH;;AACD,UAAGgN,WAAH,EAAgB;AACZlC,QAAAA,WAAW,GAAGvL,OAAO,CAAC8N,IAAR,CAAaL,WAAb,EAA0BM,MAAxC;;AACA,YAAGxC,WAAW,GAAGoC,QAAjB,EAA2B;AACvB;AACA;AACAH,UAAAA,UAAU,CAAC,CAAD,CAAV,IAAiB,CAACjC,WAAW,GAAGoC,QAAf,IAA2B,CAA5C;AACH;AACJ,OAPD,MAOO,IAAGJ,SAAS,CAACG,IAAV,MAAoB,CAACH,SAAS,CAAC3L,OAAV,CAAkBhB,EAAE,CAACoN,aAArB,CAAxB,EAA6D;AAChEzC,QAAAA,WAAW,GAAGvL,OAAO,CAAC8N,IAAR,CAAaP,SAAS,CAACG,IAAV,EAAb,EAA+BK,MAA7C;AACH;;AACD,UAAGxC,WAAH,EAAgB;AACZ;AACA;AACAA,QAAAA,WAAW,IAAI,CAAf;;AAEA,YAAG/D,SAAS,KAAK,KAAjB,EAAwB;AACpBoC,UAAAA,EAAE,CAAChC,MAAH,CAAU,CAAV,KAAgB2D,WAAW,GAAGpE,EAAE,CAACwB,CAAjC;AACA6E,UAAAA,UAAU,CAAC,CAAD,CAAV,IAAiB,CAAC,CAAlB;AACH,SAHD,MAGO;AACH5D,UAAAA,EAAE,CAAChC,MAAH,CAAU,CAAV,KAAgB2D,WAAW,GAAGpE,EAAE,CAACwB,CAAjC;AACA,cAAIsF,MAAM,GAAG9N,YAAY,CAAC+N,SAAb,CAAuBX,SAAvB,CAAb;AACAC,UAAAA,UAAU,CAAC,CAAD,CAAV,IAAiB,CAAC,IAAIS,MAAL,IAAeN,QAAhC;AACH;;AAEDL,QAAAA,UAAU,CAAC3L,IAAX,CAAgB,WAAhB,EAA6B9B,YAAY,CAAC2N,UAAU,CAAC,CAAD,CAAX,EAAgBA,UAAU,CAAC,CAAD,CAA1B,CAAzC;AACA5D,QAAAA,EAAE,CAACqB,QAAH;AACH;AACJ;;AAEDnJ,IAAAA,CAAC,CAACX,SAAF,CAAY,MAAMP,EAAE,CAACsB,OAAT,GAAmB,IAAnB,GAA0BtB,EAAE,CAACuB,OAAzC,EACKR,IADL,CACU,WADV,EACuB9B,YAAY,CAAC,CAAD,EAAIyI,IAAI,CAACC,KAAL,CAAWpB,EAAE,CAACwB,CAAH,IAAQ,IAAIiB,EAAE,CAAChC,MAAH,CAAU,CAAV,CAAZ,CAAX,CAAJ,CADnC;AAGAyD,IAAAA,OAAO,CAAC1J,IAAR,CAAa,WAAb,EAA0B9B,YAAY,CAAC,CAAD,EAAIyI,IAAI,CAACC,KAAL,CAAW,CAACpB,EAAE,CAACgE,CAAf,CAAJ,CAAtC;AAEA,QAAIgD,KAAK,GAAGrM,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAACsB,OAAlB,EACPf,SADO,CACG,UAAUP,EAAE,CAACwN,MADhB,EAEPzM,IAFO,CAEF,OAFE,EAEO,EAFP,EAGPN,IAHO,CAGF6G,UAHE,CAAZ;AAIAiG,IAAAA,KAAK,CAAC1M,KAAN,GAAcC,MAAd,CAAqB,MAArB,EACKE,OADL,CACahB,EAAE,CAACwN,MADhB,EACwB,IADxB,EAEKP,KAFL,CAEW,QAFX,EAEqB,MAFrB;AAGAM,IAAAA,KAAK,CAAChL,IAAN,GAAaE,MAAb;AAEA,QAAIgL,OAAO,GAAG3G,MAAM,CACf4G,GADS,CACL1E,EAAE,CAAC2E,GADE,EAETD,GAFS,CAELhG,IAAI,CAACC,KAFA,EAGTiG,IAHS,CAGJ,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAAE,aAAOD,CAAC,GAAGC,CAAX;AAAe,KAH5B,CAAd;AAKAP,IAAAA,KAAK,CAACtM,IAAN,CAAW,UAAS8M,CAAT,EAAY5J,CAAZ,EAAe;AACtB,UAAI6J,CAAC,GAAG,CACH7J,CAAC,KAAK,CAAP,GAAY2C,MAAM,CAAC,CAAD,CAAlB,GAAwB,CAACQ,UAAU,CAACnD,CAAD,CAAV,GAAgBmD,UAAU,CAACnD,CAAC,GAAG,CAAL,CAA3B,IAAsC,CAD1D,EAEHA,CAAC,KAAKmD,UAAU,CAAClD,MAAX,GAAoB,CAA3B,GAAgC0C,MAAM,CAAC,CAAD,CAAtC,GAA4C,CAACQ,UAAU,CAACnD,CAAD,CAAV,GAAgBmD,UAAU,CAACnD,CAAC,GAAG,CAAL,CAA3B,IAAsC,CAF9E,EAIPuJ,GAJO,CAIH1E,EAAE,CAAC2E,GAJA,EAKPD,GALO,CAKHhG,IAAI,CAACC,KALF,CAAR,CADsB,CAQtB;AACA;;AACAqG,MAAAA,CAAC,CAAC,CAAD,CAAD,GAAOhP,GAAG,CAAC2K,SAAJ,CAAcqE,CAAC,CAAC,CAAD,CAAD,IAAQA,CAAC,CAAC,CAAD,CAAD,GAAOA,CAAC,CAAC,CAAD,CAAhB,IAAuB,CAAvB,GAA2B,CAAC,CAA1C,EAA6CP,OAAO,CAAC,CAAD,CAApD,EAAyDA,OAAO,CAAC,CAAD,CAAhE,CAAP,CAVsB,CAatB;AACA;;AACA,UAAIQ,MAAM,GAAGxP,EAAE,CAAC0C,MAAH,CAAU,IAAV,EAAgBJ,IAAhB,CAAqB;AAC9BqF,QAAAA,CAAC,EAAEgC,GAD2B;AAE9BhF,QAAAA,KAAK,EAAEsE,IAAI,CAACxD,GAAL,CAASuD,OAAT,EAAkB,CAAlB,CAFuB;AAG9BnB,QAAAA,CAAC,EAAE7H,EAAE,CAACwF,GAAH,CAAO+J,CAAP,CAH2B;AAI9Bb,QAAAA,MAAM,EAAEzF,IAAI,CAACxD,GAAL,CAASzF,EAAE,CAACyF,GAAH,CAAO8J,CAAP,IAAYvP,EAAE,CAACwF,GAAH,CAAO+J,CAAP,CAArB,EAAgC,CAAhC;AAJsB,OAArB,CAAb;;AAOA,UAAGrN,IAAI,CAACgD,aAAR,EAAuB;AACnBvE,QAAAA,OAAO,CAAC8O,QAAR,CAAiBD,MAAjB,EAAyB/N,EAAzB,EAA6BS,IAAI,CAACC,GAAlC,EAAuC,UAAvC,EAAmDD,IAAI,CAACgD,aAAxD,EAAuE,MAAvE;AACH,OAFD,MAEO;AACH;AACA;AACA,YAAIwK,WAAW,GAAGjH,YAAY,CAAC6G,CAAD,CAAZ,CAAgBK,OAAhB,CAAwB,IAAxB,EAA8B,EAA9B,CAAlB;AACAH,QAAAA,MAAM,CAAClN,IAAP,CAAY,MAAZ,EAAoBpC,SAAS,CAACwP,WAAD,CAAT,CAAuBE,WAAvB,EAApB;AACH;AACJ,KA9BD;AAgCA,QAAIC,KAAK,GAAGpN,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAACuB,OAAlB,EACPhB,SADO,CACG,UAAUP,EAAE,CAACuO,MADhB,EAEP9N,IAFO,CAEFiG,IAAI,CAACvD,KAAL,IAAcuD,IAAI,CAACtD,KAAnB,GAA2BoE,UAA3B,GAAwC,EAFtC,CAAZ;AAGA8G,IAAAA,KAAK,CAACzN,KAAN,GAAcC,MAAd,CAAqB,MAArB,EACKE,OADL,CACahB,EAAE,CAACuO,MADhB,EACwB,IADxB;AAEAD,IAAAA,KAAK,CAAC/L,IAAN,GAAaE,MAAb;AACA6L,IAAAA,KAAK,CAACrN,IAAN,CAAW,UAAS8M,CAAT,EAAY;AACnBtP,MAAAA,EAAE,CAAC0C,MAAH,CAAU,IAAV,EACKJ,IADL,CACU,GADV,EACe,MAAMqH,GAAN,GAAY,GAAZ,IACNV,IAAI,CAACC,KAAL,CAAWqB,EAAE,CAAC2E,GAAH,CAAOI,CAAP,CAAX,IAAyBrH,IAAI,CAACtD,KAAL,GAAa,CAAd,GAAmB,CADrC,IAC0C,GAD1C,GACgDqE,OAF/D,EAGK+G,IAHL,CAGUpP,OAAO,CAACqP,cAHlB,EAGkC/H,IAAI,CAACtD,KAHvC,EAG8C6D,YAAY,CAAC8G,CAAD,CAH1D,EAG+DrH,IAAI,CAACrD,IAHpE;AAIH,KALD,EAnGgB,CA0GhB;;AACAoH,IAAAA,OAAO,CAAClK,SAAR,CAAkB,OAAOyI,EAAE,CAACpI,GAAV,GAAgB,WAAlC,EAA+C6B,MAA/C;AAEA,QAAIiM,KAAK,GAAGtG,GAAG,GAAGX,OAAN,GACR,CAAC5B,YAAY,IAAI,CAAjB,IAAsB,CADd,IACmBlF,IAAI,CAACgO,KAAL,KAAe,SAAf,GAA2B,CAA3B,GAA+B,CADlD,CAAZ;AAGA,QAAIC,IAAI,GAAG9P,IAAI,CAAC+P,SAAL,CAAe7F,EAAf,CAAX;AACA,QAAI8F,QAAQ,GAAGhQ,IAAI,CAACiQ,YAAL,CAAkB/F,EAAlB,EAAsB,CAAtB,CAAf;AAEAlK,IAAAA,IAAI,CAACkQ,SAAL,CAAe9O,EAAf,EAAmB8I,EAAnB,EAAuB;AACnB4F,MAAAA,IAAI,EAAE5F,EAAE,CAAC2F,KAAH,KAAa,QAAb,GAAwB7P,IAAI,CAACmQ,QAAL,CAAcjG,EAAd,EAAkB4F,IAAlB,CAAxB,GAAkDA,IADrC;AAEnBM,MAAAA,KAAK,EAAEzE,OAFY;AAGnB0E,MAAAA,IAAI,EAAErQ,IAAI,CAACsQ,YAAL,CAAkBpG,EAAlB,EAAsB0F,KAAtB,EAA6BI,QAA7B,CAHa;AAInBO,MAAAA,OAAO,EAAEvQ,IAAI,CAACwQ,eAAL,CAAqBtG,EAArB;AAJU,KAAvB;AAOA,WAAOlK,IAAI,CAACyQ,UAAL,CAAgBrP,EAAhB,EAAoB8I,EAApB,EAAwB;AAC3B4F,MAAAA,IAAI,EAAEA,IADqB;AAE3BM,MAAAA,KAAK,EAAEzE,OAFoB;AAG3B4E,MAAAA,OAAO,EAAEvQ,IAAI,CAAC0Q,oBAAL,CAA0BxG,EAA1B,CAHkB;AAI3ByG,MAAAA,QAAQ,EAAE3Q,IAAI,CAAC4Q,YAAL,CAAkB1G,EAAlB,EAAsB0F,KAAtB;AAJiB,KAAxB,CAAP;AAMH,GA3T8B,CA6T/B;AACA;AACA;AACA;;;AACA,WAASiB,UAAT,GAAsB;AAClB,QAAIC,cAAc,GAAGnI,OAAO,GAAG5B,YAAY,GAAG,CAA9C;;AACA,QAAGmD,EAAE,CAAC6G,iBAAH,CAAqBzG,OAArB,CAA6B,QAA7B,MAA2C,CAAC,CAA/C,EAAkD;AAC9CwG,MAAAA,cAAc,IAAIxQ,OAAO,CAAC8N,IAAR,CAAazC,OAAO,CAACqC,IAAR,EAAb,EAA6B1J,KAA/C;AACH;;AAEDsH,IAAAA,OAAO,GAAGF,SAAS,CAACrJ,MAAV,CAAiB,MAAjB,CAAV;;AAEA,QAAGuJ,OAAO,CAACoC,IAAR,MAAkB,CAACpC,OAAO,CAAC1J,OAAR,CAAgBhB,EAAE,CAACoN,aAAnB,CAAtB,EAAyD;AACrD,UAAIP,WAAW,GAAGrC,SAAS,CAACrJ,MAAV,CAAiB,OAAO6H,EAAE,CAACpI,GAAV,GAAgB,kBAAjC,EAAqDkM,IAArD,EAAlB;AACA,UAAIgD,UAAJ;;AACA,UAAGjD,WAAW,IAAI,CAAC,KAAD,EAAQ,QAAR,EAAkBzD,OAAlB,CAA0BxC,SAA1B,MAAyC,CAAC,CAA5D,EAA+D;AAC3DkJ,QAAAA,UAAU,GAAG1Q,OAAO,CAAC8N,IAAR,CAAaL,WAAb,EAA0BzJ,KAAvC;AACH,OAFD,MAEO;AACH;AACA;AACA;AACA;AACA0M,QAAAA,UAAU,GAAG1Q,OAAO,CAAC8N,IAAR,CAAa1C,SAAS,CAACsC,IAAV,EAAb,EAA+BvE,KAA/B,GAAuCH,GAAvC,GAA6C7B,EAAE,CAAC+D,CAA7D;AACH;;AACDsF,MAAAA,cAAc,GAAGlI,IAAI,CAACxD,GAAL,CAAS0L,cAAT,EAAyBE,UAAzB,CAAjB;AACH;;AAED,QAAIC,cAAc,GAAG,IAAI9J,IAAJ,GAAW2J,cAAX,GAA4B9J,WAA5B,GAA0CD,YAAY,GAAG,CAA9E;AAEA3E,IAAAA,CAAC,CAACC,MAAF,CAAS,MAAMnB,EAAE,CAACqB,IAAlB,EAAwBN,IAAxB,CAA6B;AACzBqF,MAAAA,CAAC,EAAEgC,GAAG,GAAGnC,IAAN,GAAa,CAACH,WAAW,GAAGD,YAAf,IAA+B,CADtB;AAEzBS,MAAAA,CAAC,EAAEqC,GAAG,GAAGb,KAAN,GAAcI,QAFQ;AAGzB9E,MAAAA,KAAK,EAAEsE,IAAI,CAACxD,GAAL,CAAS6L,cAAT,EAAyB,CAAzB,CAHkB;AAIzB5C,MAAAA,MAAM,EAAEzF,IAAI,CAACxD,GAAL,CAAS4D,KAAK,GAAG,IAAII,QAArB,EAA+B,CAA/B;AAJiB,KAA7B,EAMCsG,IAND,CAMMnP,KAAK,CAACkI,IANZ,EAMkB5G,IAAI,CAACqP,OANvB,EAOCxB,IAPD,CAOMnP,KAAK,CAAC4Q,MAPZ,EAOoBtP,IAAI,CAACuP,WAPzB,EAQCjD,KARD,CAQO,cARP,EAQuBnH,WARvB;AAUA5E,IAAAA,CAAC,CAACX,SAAF,CAAY,MAAMP,EAAE,CAAC6B,SAArB,EAAgCd,IAAhC,CAAqC;AACjCqF,MAAAA,CAAC,EAAEgC,GAD8B;AAEjC9B,MAAAA,CAAC,EAAEqC,GAAG,GAAGb,KAAN,GAAc5B,IAAd,IAAsBU,SAAS,KAAK,KAAd,GAAsB+D,WAAtB,GAAoC,CAA1D,CAF8B;AAGjCvH,MAAAA,KAAK,EAAEsE,IAAI,CAACxD,GAAL,CAASuD,OAAT,EAAkB,CAAlB,CAH0B;AAIjC0F,MAAAA,MAAM,EAAEzF,IAAI,CAACxD,GAAL,CAAS4D,KAAK,GAAG,IAAI5B,IAAZ,GAAmByE,WAA5B,EAAyC,CAAzC;AAJyB,KAArC,EAMC6D,IAND,CAMMnP,KAAK,CAAC4Q,MANZ,EAMoBtP,IAAI,CAACwP,YANzB,EAOClD,KAPD,CAOO;AACH1F,MAAAA,IAAI,EAAE,MADH;AAEH,sBAAgB1B;AAFb,KAPP,EAnCkB,CA+ClB;;AACA,QAAIuK,OAAO,GAAG,CAAC;AAAC9H,MAAAA,MAAM,EAAE,GAAT;AAAcC,MAAAA,KAAK,EAAE;AAArB,MAAwBxC,OAAxB,KAAoC,CAArC,IAA0CgK,cAAxD;AACA7O,IAAAA,CAAC,CAACH,IAAF,CAAO,WAAP,EAAoB9B,YAAY,CAACsH,EAAE,CAAC+D,CAAH,GAAO8F,OAAR,EAAiB7J,EAAE,CAACgE,CAApB,CAAhC,EAjDkB,CAmDlB;;AACA,QAAI8F,UAAU,GAAG,EAAjB;AACA,QAAIC,KAAK,GAAGxQ,OAAO,CAACkG,OAAD,CAAnB;AACA,QAAIuK,KAAK,GAAGxQ,OAAO,CAACiG,OAAD,CAAnB;;AACA,QAAGN,OAAO,KAAK,QAAf,EAAyB;AACrB2K,MAAAA,UAAU,CAAC/J,CAAX,GAAeD,KAAf;AACAgK,MAAAA,UAAU,CAAC9F,CAAX,GAAezC,KAAK,GAAGwI,KAAvB;AACAD,MAAAA,UAAU,CAACvC,CAAX,GAAehG,KAAK,GAAGyI,KAAvB;AACH,KAJD,MAIO;AACHF,MAAAA,UAAU,CAAC9F,CAAX,GAAe8F,UAAU,CAACvC,CAAX,GAAe,CAA9B;AACAuC,MAAAA,UAAU,CAACG,EAAX,GAAgBnK,KAAK,GAAGZ,GAAG,GAAG6K,KAA9B;AACAD,MAAAA,UAAU,CAACI,EAAX,GAAgBpK,KAAK,GAAGZ,GAAG,GAAG8K,KAA9B;AACH;;AAED,QAAIG,KAAK,GAAG5Q,OAAO,CAACiG,OAAD,CAAnB;AACA,QAAI4K,KAAK,GAAG5Q,OAAO,CAACgG,OAAD,CAAnB;;AACA,QAAGH,aAAa,KAAK,QAArB,EAA+B;AAC3ByK,MAAAA,UAAU,CAACjK,CAAX,GAAeD,KAAf;AACAkK,MAAAA,UAAU,CAAC/F,CAAX,GAAeyF,cAAc,GAAGW,KAAhC;AACAL,MAAAA,UAAU,CAACO,CAAX,GAAeb,cAAc,GAAGY,KAAhC;AACH,KAJD,MAIO;AACH,UAAIE,cAAc,GAAGd,cAAc,GAAGtI,OAAtC;AACA4I,MAAAA,UAAU,CAAC/F,CAAX,GAAeuG,cAAc,GAAGH,KAAhC;AACAL,MAAAA,UAAU,CAACO,CAAX,GAAeC,cAAc,GAAGF,KAAhC;AACAN,MAAAA,UAAU,CAACS,EAAX,GAAgB3K,KAAK,GAAGR,SAAS,GAAG+K,KAApC;AACAL,MAAAA,UAAU,CAACU,EAAX,GAAgB5K,KAAK,GAAGR,SAAS,GAAGgL,KAApC;AACH;;AAED/R,IAAAA,KAAK,CAAC4D,UAAN,CAAiBtC,EAAjB,EAAqBS,IAAI,CAACC,GAA1B,EAA+ByP,UAA/B;AACH;;AAED,SAAOrR,GAAG,CAACgS,WAAJ,CAAgB,CACnBpS,KAAK,CAACqS,gBADa,EAEnBxF,cAFmB,EAGnBgB,QAHmB,EAInBZ,WAJmB,EAKnBjN,KAAK,CAACqS,gBALa,EAMnBtB,UANmB,CAAhB,EAOJzP,EAPI,CAAP;AAQH;;AAED,SAASoC,YAAT,CAAsBpB,CAAtB,EAAyBP,IAAzB,EAA+BT,EAA/B,EAAmC;AAC/B,MAAIC,UAAU,GAAGD,EAAE,CAACE,WAApB;AACA,MAAImG,EAAE,GAAGpG,UAAU,CAACqG,KAApB;AACA,MAAI0K,EAAJ,EAAQC,EAAR,EAAYC,EAAZ;AAEArS,EAAAA,WAAW,CAACsS,IAAZ,CAAiB;AACbC,IAAAA,OAAO,EAAEpQ,CAAC,CAAC4L,IAAF,EADI;AAEb5M,IAAAA,EAAE,EAAEA,EAFS;AAGbqR,IAAAA,MAAM,EAAE,YAAW;AACfL,MAAAA,EAAE,GAAGhQ,CAAC,CAACH,IAAF,CAAO,WAAP,CAAL;AACA5B,MAAAA,SAAS,CAAC+B,CAAD,CAAT;AACH,KANY;AAObsQ,IAAAA,MAAM,EAAE,UAASC,EAAT,EAAaC,EAAb,EAAiB;AACrBxQ,MAAAA,CAAC,CAACH,IAAF,CAAO,WAAP,EAAoBmQ,EAAE,GAAGjS,YAAY,CAACwS,EAAD,EAAKC,EAAL,CAArC;AAEAP,MAAAA,EAAE,GAAGpS,WAAW,CAAC4S,KAAZ,CAAkBhR,IAAI,CAACmI,MAAL,GAAe2I,EAAE,GAAGlL,EAAE,CAACqB,CAAzC,EAA6CjH,IAAI,CAACkI,UAAlD,EACD,CADC,EACE,CADF,EACKlI,IAAI,CAACoF,OADV,CAAL;AAEAqL,MAAAA,EAAE,GAAGrS,WAAW,CAAC4S,KAAZ,CAAkBhR,IAAI,CAACoI,MAAL,GAAe2I,EAAE,GAAGnL,EAAE,CAACwB,CAAzC,EAA6CpH,IAAI,CAACiI,QAAlD,EACD,CADC,EACE,CADF,EACKjI,IAAI,CAACqF,OADV,CAAL;AAGA,UAAI4L,GAAG,GAAG7S,WAAW,CAAC8S,SAAZ,CAAsBV,EAAtB,EAA0BC,EAA1B,EAA8BzQ,IAAI,CAACoF,OAAnC,EAA4CpF,IAAI,CAACqF,OAAjD,CAAV;AACA7G,MAAAA,SAAS,CAAC+B,CAAD,EAAI0Q,GAAJ,CAAT;AACH,KAjBY;AAkBbE,IAAAA,MAAM,EAAE,YAAW;AACf3S,MAAAA,SAAS,CAAC+B,CAAD,CAAT;;AAEA,UAAGiQ,EAAE,KAAKY,SAAP,IAAoBX,EAAE,KAAKW,SAA9B,EAAyC;AACrC,YAAIC,MAAM,GAAG,EAAb;AACAA,QAAAA,MAAM,CAACrR,IAAI,CAACyE,WAAL,GAAmB,GAApB,CAAN,GAAiC+L,EAAjC;AACAa,QAAAA,MAAM,CAACrR,IAAI,CAACyE,WAAL,GAAmB,GAApB,CAAN,GAAiCgM,EAAjC;;AACA,YAAGzQ,IAAI,CAACuE,WAAL,KAAqB6M,SAAxB,EAAmC;AAC/BlT,UAAAA,QAAQ,CAAC2P,IAAT,CAAc,aAAd,EAA6BtO,EAA7B,EAAiC8R,MAAjC,EAAyCrR,IAAI,CAACuE,WAA9C;AACH,SAFD,MAEO;AACHrG,UAAAA,QAAQ,CAAC2P,IAAT,CAAc,cAAd,EAA8BtO,EAA9B,EAAkC8R,MAAlC;AACH;AACJ;AACJ;AA/BY,GAAjB;AAiCH;;AAED,SAAS3K,UAAT,CAAoBnH,EAApB,EAAwBS,IAAxB,EAA8BmG,MAA9B,EAAsC;AAClC,MAAIK,QAAQ,GAAGxG,IAAI,CAAC2C,OAApB;AACA,MAAIkE,UAAU,GAAG,EAAjB;AACA,MAAIF,UAAU,GAAG,EAAjB;AACA,MAAIgD,CAAJ;AACA,MAAInG,CAAJ;AAEA,MAAI8N,EAAE,GAAG9K,QAAQ,CAAC3D,GAAT,GAAe2D,QAAQ,CAAC1D,IAAT,GAAgB,GAAxC;AACA,MAAIyO,EAAE,GAAG/K,QAAQ,CAAC1D,IAAlB;AACA,MAAI0O,GAAG,GAAI,QAAQrL,MAAM,CAAC,CAAD,CAAd,GAAoB,QAAQA,MAAM,CAAC,CAAD,CAA7C;AACA,MAAIsL,GAAG,GAAI,QAAQtL,MAAM,CAAC,CAAD,CAAd,GAAoB,QAAQA,MAAM,CAAC,CAAD,CAA7C;;AAEA,OAAI3C,CAAC,GAAG,CAAR,EAAWA,CAAC,GAAG,GAAf,EAAoBA,CAAC,EAArB,EAAyB;AACrBmG,IAAAA,CAAC,GAAGnD,QAAQ,CAAC5D,KAAT,GAAiBY,CAAC,GAAG+N,EAAzB;AACA,QAAGA,EAAE,GAAG,CAAL,GAAU5H,CAAC,IAAI2H,EAAf,GAAsB3H,CAAC,IAAI2H,EAA9B,EAAmC;AACnC,QAAG3H,CAAC,GAAG6H,GAAJ,IAAW7H,CAAC,GAAG8H,GAAlB,EAAuB5K,UAAU,CAACtF,IAAX,CAAgBoI,CAAhB;AAC1B;;AAED,MAAG3J,IAAI,CAACgD,aAAR,EAAuB;AACnB2D,IAAAA,UAAU,GAAG,CAAC,CAAD,CAAb;AACH,GAFD,MAEO,IAAG,OAAO3G,IAAI,CAACsC,UAAZ,KAA2B,UAA9B,EAA0C;AAC7C,QAAIoP,YAAY,GAAG1R,IAAI,CAAC+C,WAAxB;;AAEA,QAAG2O,YAAH,EAAiB;AACbJ,MAAAA,EAAE,GAAGI,YAAY,CAAC7O,GAAb,GAAmB6O,YAAY,CAAC5O,IAAb,GAAoB,GAA5C;AACAyO,MAAAA,EAAE,GAAGG,YAAY,CAAC5O,IAAlB;;AACA,WAAIU,CAAC,GAAG,CAAR,EAAWA,CAAC,GAAG,GAAf,EAAoBA,CAAC,EAArB,EAAyB;AACrBmG,QAAAA,CAAC,GAAG+H,YAAY,CAAC9O,KAAb,GAAqBY,CAAC,GAAG+N,EAA7B;AACA,YAAGA,EAAE,GAAG,CAAL,GAAU5H,CAAC,IAAI2H,EAAf,GAAsB3H,CAAC,IAAI2H,EAA9B,EAAmC;AACnC,YAAG3H,CAAC,GAAGxD,MAAM,CAAC,CAAD,CAAV,IAAiBwD,CAAC,GAAGxD,MAAM,CAAC,CAAD,CAA9B,EAAmCQ,UAAU,CAACpF,IAAX,CAAgBoI,CAAhB;AACtC;AACJ,KARD,MAQO;AACHhD,MAAAA,UAAU,GAAGE,UAAU,CAACkG,GAAX,CAAe,UAAS4E,CAAT,EAAY;AACpC,eAAOA,CAAC,GAAGnL,QAAQ,CAAC1D,IAAT,GAAgB,CAA3B;AACH,OAFY,CAAb;AAGA6D,MAAAA,UAAU,CAACpF,IAAX,CAAgBoF,UAAU,CAACA,UAAU,CAAClD,MAAX,GAAoB,CAArB,CAAV,GAAoC+C,QAAQ,CAAC1D,IAA7D;AACH;AACJ,GAjBM,MAiBA,IAAG9C,IAAI,CAACsC,UAAL,IAAmB,OAAOtC,IAAI,CAACsC,UAAZ,KAA2B,QAAjD,EAA2D;AAC9D;AACA;AACAqE,IAAAA,UAAU,GAAG,CAAC,CAAD,CAAb;AACH;;AAED,MAAGH,QAAQ,CAAC1D,IAAT,GAAgB,CAAnB,EAAsB;AAClB+D,IAAAA,UAAU,CAAC+K,OAAX;AACAjL,IAAAA,UAAU,CAACiL,OAAX;AACH;;AAED,SAAO;AAAC7L,IAAAA,IAAI,EAAEc,UAAP;AAAmBD,IAAAA,IAAI,EAAED;AAAzB,GAAP;AACH;;AAED,SAAS4B,gBAAT,CAA0BhJ,EAA1B,EAA8BS,IAA9B,EAAoCmG,MAApC,EAA4C;AACxC,MAAI3G,UAAU,GAAGD,EAAE,CAACE,WAApB;AAEA,MAAIoS,QAAQ,GAAG;AACXC,IAAAA,IAAI,EAAE,QADK;AAEXC,IAAAA,KAAK,EAAE5L,MAFI;AAGXyC,IAAAA,QAAQ,EAAE5I,IAAI,CAAC4I,QAHJ;AAIXM,IAAAA,MAAM,EAAElJ,IAAI,CAACkJ,MAJF;AAKXL,IAAAA,KAAK,EAAE7I,IAAI,CAAC6I,KALD;AAMXC,IAAAA,KAAK,EAAE9I,IAAI,CAAC8I,KAND;AAOXkJ,IAAAA,QAAQ,EAAEhS,IAAI,CAACgS,QAPJ;AAQXC,IAAAA,QAAQ,EAAEjS,IAAI,CAACiS,QARJ;AASXjE,IAAAA,KAAK,EAAEhO,IAAI,CAACgO,KATD;AAUXkE,IAAAA,OAAO,EAAElS,IAAI,CAACkS,OAVH;AAWXC,IAAAA,SAAS,EAAEnS,IAAI,CAACmS,SAXL;AAYXC,IAAAA,SAAS,EAAEpS,IAAI,CAACoS,SAZL;AAaX/G,IAAAA,cAAc,EAAErL,IAAI,CAACqL,cAbV;AAcX6D,IAAAA,iBAAiB,EAAElP,IAAI,CAACkP,iBAdb;AAeXmD,IAAAA,iBAAiB,EAAErS,IAAI,CAACqS,iBAfb;AAgBXC,IAAAA,QAAQ,EAAEtS,IAAI,CAACsS,QAhBJ;AAiBXC,IAAAA,SAAS,EAAEvS,IAAI,CAACuS,SAjBL;AAkBXC,IAAAA,UAAU,EAAExS,IAAI,CAACwS,UAlBN;AAmBXC,IAAAA,cAAc,EAAEzS,IAAI,CAACyS,cAnBV;AAoBXC,IAAAA,WAAW,EAAE1S,IAAI,CAAC0S,WApBP;AAqBXC,IAAAA,iBAAiB,EAAE3S,IAAI,CAAC2S,iBArBb;AAsBXC,IAAAA,YAAY,EAAE5S,IAAI,CAAC4S,YAtBR;AAuBXC,IAAAA,cAAc,EAAE7S,IAAI,CAAC6S,cAvBV;AAwBXC,IAAAA,UAAU,EAAE9S,IAAI,CAAC8S,UAxBN;AAyBXC,IAAAA,cAAc,EAAE/S,IAAI,CAAC+S,cAzBV;AA0BXC,IAAAA,UAAU,EAAEhT,IAAI,CAACgT,UA1BN;AA2BXhN,IAAAA,KAAK,EAAEhG,IAAI,CAACgG,KA3BD;AA4BXiN,IAAAA,QAAQ,EAAE,IA5BC;AA6BXC,IAAAA,MAAM,EAAE,MA7BG;AA8BXhN,IAAAA,IAAI,EAAE,OA9BK;AA+BXsC,IAAAA,QAAQ,EAAE;AA/BC,GAAf;AAkCA,MAAI2K,SAAS,GAAG;AACZrB,IAAAA,IAAI,EAAE,QADM;AAEZ7R,IAAAA,GAAG,EAAE,MAAMD,IAAI,CAACC;AAFJ,GAAhB;AAKA,MAAImT,WAAW,GAAG;AACdC,IAAAA,MAAM,EAAE,GADM;AAEdrI,IAAAA,IAAI,EAAExL,UAAU,CAACwL,IAFH;AAGdsI,IAAAA,OAAO,EAAE,IAHK;AAIdC,IAAAA,SAAS,EAAE,IAJG;AAKdC,IAAAA,eAAe,EAAE,IALH;AAMdC,IAAAA,QAAQ,EAAEjU,UAAU,CAACiU,QANP,CAMiB;;AANjB,GAAlB;;AASA,WAASC,MAAT,CAAgBtT,IAAhB,EAAsBuT,IAAtB,EAA4B;AACxB,WAAOtV,GAAG,CAACqV,MAAJ,CAAW7B,QAAX,EAAqBsB,SAArB,EAAgCnU,eAAhC,EAAiDoB,IAAjD,EAAuDuT,IAAvD,CAAP;AACH;;AAED7U,EAAAA,kBAAkB,CAAC+S,QAAD,EAAWsB,SAAX,EAAsBO,MAAtB,EAA8BN,WAA9B,EAA2C5T,UAA3C,CAAlB;AACAT,EAAAA,0BAA0B,CAAC8S,QAAD,EAAWsB,SAAX,EAAsBO,MAAtB,EAA8BN,WAA9B,CAA1B;AAEA,SAAOD,SAAP;AACH;;AAEDS,MAAM,CAACC,OAAP,GAAiB;AACbvU,EAAAA,IAAI,EAAEA;AADO,CAAjB","sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\nvar tinycolor = require('tinycolor2');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar dragElement = require('../dragelement');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar setCursor = require('../../lib/setcursor');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar Titles = require('../titles');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar flipScale = require('../colorscale/helpers').flipScale;\n\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\n\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar cn = require('./constants').cn;\n\nfunction draw(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var colorBars = fullLayout._infolayer\n        .selectAll('g.' + cn.colorbar)\n        .data(makeColorBarData(gd), function(opts) { return opts._id; });\n\n    colorBars.enter().append('g')\n        .attr('class', function(opts) { return opts._id; })\n        .classed(cn.colorbar, true);\n\n    colorBars.each(function(opts) {\n        var g = d3.select(this);\n\n        Lib.ensureSingle(g, 'rect', cn.cbbg);\n        Lib.ensureSingle(g, 'g', cn.cbfills);\n        Lib.ensureSingle(g, 'g', cn.cblines);\n        Lib.ensureSingle(g, 'g', cn.cbaxis, function(s) { s.classed(cn.crisp, true); });\n        Lib.ensureSingle(g, 'g', cn.cbtitleunshift, function(s) { s.append('g').classed(cn.cbtitle, true); });\n        Lib.ensureSingle(g, 'rect', cn.cboutline);\n\n        var done = drawColorBar(g, opts, gd);\n        if(done && done.then) (gd._promises || []).push(done);\n\n        if(gd._context.edits.colorbarPosition) {\n            makeEditable(g, opts, gd);\n        }\n    });\n\n    colorBars.exit()\n        .each(function(opts) { Plots.autoMargin(gd, opts._id); })\n        .remove();\n\n    colorBars.order();\n}\n\nfunction makeColorBarData(gd) {\n    var fullLayout = gd._fullLayout;\n    var calcdata = gd.calcdata;\n    var out = [];\n\n    // single out item\n    var opts;\n    // colorbar attr parent container\n    var cont;\n    // trace attr container\n    var trace;\n    // colorbar options\n    var cbOpt;\n\n    function initOpts(opts) {\n        return extendFlat(opts, {\n            // fillcolor can be a d3 scale, domain is z values, range is colors\n            // or leave it out for no fill,\n            // or set to a string constant for single-color fill\n            _fillcolor: null,\n            // line.color has the same options as fillcolor\n            _line: {color: null, width: null, dash: null},\n            // levels of lines to draw.\n            // note that this DOES NOT determine the extent of the bar\n            // that's given by the domain of fillcolor\n            // (or line.color if no fillcolor domain)\n            _levels: {start: null, end: null, size: null},\n            // separate fill levels (for example, heatmap coloring of a\n            // contour map) if this is omitted, fillcolors will be\n            // evaluated halfway between levels\n            _filllevels: null,\n            // for continuous colorscales: fill with a gradient instead of explicit levels\n            // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n            _fillgradient: null,\n            // when using a gradient, we need the data range specified separately\n            _zrange: null\n        });\n    }\n\n    function calcOpts() {\n        if(typeof cbOpt.calc === 'function') {\n            cbOpt.calc(gd, trace, opts);\n        } else {\n            opts._fillgradient = cont.reversescale ?\n                flipScale(cont.colorscale) :\n                cont.colorscale;\n            opts._zrange = [cont[cbOpt.min], cont[cbOpt.max]];\n        }\n    }\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        trace = cd[0].trace;\n        var moduleOpts = trace._module.colorbar;\n\n        if(trace.visible === true && moduleOpts) {\n            var allowsMultiplotCbs = Array.isArray(moduleOpts);\n            var cbOpts = allowsMultiplotCbs ? moduleOpts : [moduleOpts];\n\n            for(var j = 0; j < cbOpts.length; j++) {\n                cbOpt = cbOpts[j];\n                var contName = cbOpt.container;\n                cont = contName ? trace[contName] : trace;\n\n                if(cont && cont.showscale) {\n                    opts = initOpts(cont.colorbar);\n                    opts._id = 'cb' + trace.uid + (allowsMultiplotCbs && contName ? '-' + contName : '');\n                    opts._traceIndex = trace.index;\n                    opts._propPrefix = (contName ? contName + '.' : '') + 'colorbar.';\n                    opts._meta = trace._meta;\n                    calcOpts();\n                    out.push(opts);\n                }\n            }\n        }\n    }\n\n    for(var k in fullLayout._colorAxes) {\n        cont = fullLayout[k];\n\n        if(cont.showscale) {\n            var colorAxOpts = fullLayout._colorAxes[k];\n\n            opts = initOpts(cont.colorbar);\n            opts._id = 'cb' + k;\n            opts._propPrefix = k + '.colorbar.';\n            opts._meta = fullLayout._meta;\n\n            cbOpt = {min: 'cmin', max: 'cmax'};\n            if(colorAxOpts[0] !== 'heatmap') {\n                trace = colorAxOpts[1];\n                cbOpt.calc = trace._module.colorbar.calc;\n            }\n\n            calcOpts();\n            out.push(opts);\n        }\n    }\n\n    return out;\n}\n\nfunction drawColorBar(g, opts, gd) {\n    var len = opts.len;\n    var lenmode = opts.lenmode;\n    var thickness = opts.thickness;\n    var thicknessmode = opts.thicknessmode;\n    var outlinewidth = opts.outlinewidth;\n    var borderwidth = opts.borderwidth;\n    var xanchor = opts.xanchor;\n    var yanchor = opts.yanchor;\n    var xpad = opts.xpad;\n    var ypad = opts.ypad;\n    var optsX = opts.x;\n    var optsY = opts.y;\n\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n\n    var fillColor = opts._fillcolor;\n    var line = opts._line;\n    var title = opts.title;\n    var titleSide = title.side;\n\n    var zrange = opts._zrange ||\n        d3.extent((typeof fillColor === 'function' ? fillColor : line.color).domain());\n\n    var lineColormap = typeof line.color === 'function' ?\n        line.color :\n        function() { return line.color; };\n    var fillColormap = typeof fillColor === 'function' ?\n        fillColor :\n        function() { return fillColor; };\n\n    var levelsIn = opts._levels;\n    var levelsOut = calcLevels(gd, opts, zrange);\n    var fillLevels = levelsOut.fill;\n    var lineLevels = levelsOut.line;\n\n    // we calculate pixel sizes based on the specified graph size,\n    // not the actual (in case something pushed the margins around)\n    // which is a little odd but avoids an odd iterative effect\n    // when the colorbar itself is pushing the margins.\n    // but then the fractional size is calculated based on the\n    // actual graph size, so that the axes will size correctly.\n    var thickPx = Math.round(thickness * (thicknessmode === 'fraction' ? gs.w : 1));\n    var thickFrac = thickPx / gs.w;\n    var lenPx = Math.round(len * (lenmode === 'fraction' ? gs.h : 1));\n    var lenFrac = lenPx / gs.h;\n    var xpadFrac = xpad / gs.w;\n    var yExtraPx = (borderwidth + outlinewidth) / 2;\n    var ypadFrac = ypad / gs.h;\n\n    // x positioning: do it initially just for left anchor,\n    // then fix at the end (since we don't know the width yet)\n    var uPx = Math.round(optsX * gs.w + xpad);\n    // for dragging... this is getting a little muddled...\n    var uFrac = optsX - thickFrac * ({center: 0.5, right: 1}[xanchor] || 0);\n\n    // y positioning we can do correctly from the start\n    var vFrac = optsY + lenFrac * (({top: -0.5, bottom: 0.5}[yanchor] || 0) - 0.5);\n    var vPx = Math.round(gs.h * (1 - vFrac));\n\n    // stash a few things for makeEditable\n    opts._lenFrac = lenFrac;\n    opts._thickFrac = thickFrac;\n    opts._uFrac = uFrac;\n    opts._vFrac = vFrac;\n\n    // stash mocked axis for contour label formatting\n    var ax = opts._axis = mockColorBarAxis(gd, opts, zrange);\n\n    // position can't go in through supplyDefaults\n    // because that restricts it to [0,1]\n    ax.position = optsX + xpadFrac + thickFrac;\n\n    if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n        ax.title.side = titleSide;\n        ax.titlex = optsX + xpadFrac;\n        ax.titley = vFrac + (title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n    }\n\n    if(line.color && opts.tickmode === 'auto') {\n        ax.tickmode = 'linear';\n        ax.tick0 = levelsIn.start;\n        var dtick = levelsIn.size;\n        // expand if too many contours, so we don't get too many ticks\n        var autoNtick = Lib.constrain(lenPx / 50, 4, 15) + 1;\n        var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n        if(dtFactor > 1) {\n            var dtexp = Math.pow(10, Math.floor(Math.log(dtFactor) / Math.LN10));\n            dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]);\n            // if the contours are at round multiples, reset tick0\n            // so they're still at round multiples. Otherwise,\n            // keep the first label on the first contour level\n            if((Math.abs(levelsIn.start) / levelsIn.size + 1e-6) % 1 < 2e-6) {\n                ax.tick0 = 0;\n            }\n        }\n        ax.dtick = dtick;\n    }\n\n    // set domain after init, because we may want to\n    // allow it outside [0,1]\n    ax.domain = [\n        vFrac + ypadFrac,\n        vFrac + lenFrac - ypadFrac\n    ];\n\n    ax.setScale();\n\n    g.attr('transform', strTranslate(Math.round(gs.l), Math.round(gs.t)));\n\n    var titleCont = g.select('.' + cn.cbtitleunshift)\n        .attr('transform', strTranslate(-Math.round(gs.l), -Math.round(gs.t)));\n\n    var axLayer = g.select('.' + cn.cbaxis);\n    var titleEl;\n    var titleHeight = 0;\n\n    function drawTitle(titleClass, titleOpts) {\n        var dfltTitleOpts = {\n            propContainer: ax,\n            propName: opts._propPrefix + 'title',\n            traceIndex: opts._traceIndex,\n            _meta: opts._meta,\n            placeholder: fullLayout._dfltTitle.colorbar,\n            containerGroup: g.select('.' + cn.cbtitle)\n        };\n\n        // this class-to-rotate thing with convertToTspans is\n        // getting hackier and hackier... delete groups with the\n        // wrong class (in case earlier the colorbar was drawn on\n        // a different side, I think?)\n        var otherClass = titleClass.charAt(0) === 'h' ?\n            titleClass.substr(1) :\n            'h' + titleClass;\n        g.selectAll('.' + otherClass + ',.' + otherClass + '-math-group').remove();\n\n        Titles.draw(gd, titleClass, extendFlat(dfltTitleOpts, titleOpts || {}));\n    }\n\n    function drawDummyTitle() {\n        if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n            // draw the title so we know how much room it needs\n            // when we squish the axis. This one only applies to\n            // top or bottom titles, not right side.\n            var x = gs.l + (optsX + xpadFrac) * gs.w;\n            var fontSize = ax.title.font.size;\n            var y;\n\n            if(titleSide === 'top') {\n                y = (1 - (vFrac + lenFrac - ypadFrac)) * gs.h +\n                    gs.t + 3 + fontSize * 0.75;\n            } else {\n                y = (1 - (vFrac + ypadFrac)) * gs.h +\n                    gs.t - 3 - fontSize * 0.25;\n            }\n            drawTitle(ax._id + 'title', {\n                attributes: {x: x, y: y, 'text-anchor': 'start'}\n            });\n        }\n    }\n\n    function drawCbTitle() {\n        if(['top', 'bottom'].indexOf(titleSide) === -1) {\n            var fontSize = ax.title.font.size;\n            var y = ax._offset + ax._length / 2;\n            var x = gs.l + (ax.position || 0) * gs.w + ((ax.side === 'right') ?\n                10 + fontSize * ((ax.showticklabels ? 1 : 0.5)) :\n                -10 - fontSize * ((ax.showticklabels ? 0.5 : 0)));\n\n            // the 'h' + is a hack to get around the fact that\n            // convertToTspans rotates any 'y...' class by 90 degrees.\n            // TODO: find a better way to control this.\n            drawTitle('h' + ax._id + 'title', {\n                avoid: {\n                    selection: d3.select(gd).selectAll('g.' + ax._id + 'tick'),\n                    side: titleSide,\n                    offsetLeft: gs.l,\n                    offsetTop: 0,\n                    maxShift: fullLayout.width\n                },\n                attributes: {x: x, y: y, 'text-anchor': 'middle'},\n                transform: {rotate: '-90', offset: 0}\n            });\n        }\n    }\n\n    function drawAxis() {\n        if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n            // squish the axis top to make room for the title\n            var titleGroup = g.select('.' + cn.cbtitle);\n            var titleText = titleGroup.select('text');\n            var titleTrans = [-outlinewidth / 2, outlinewidth / 2];\n            var mathJaxNode = titleGroup\n                .select('.h' + ax._id + 'title-math-group')\n                .node();\n            var lineSize = 15.6;\n            if(titleText.node()) {\n                lineSize = parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n            }\n            if(mathJaxNode) {\n                titleHeight = Drawing.bBox(mathJaxNode).height;\n                if(titleHeight > lineSize) {\n                    // not entirely sure how mathjax is doing\n                    // vertical alignment, but this seems to work.\n                    titleTrans[1] -= (titleHeight - lineSize) / 2;\n                }\n            } else if(titleText.node() && !titleText.classed(cn.jsPlaceholder)) {\n                titleHeight = Drawing.bBox(titleText.node()).height;\n            }\n            if(titleHeight) {\n                // buffer btwn colorbar and title\n                // TODO: configurable\n                titleHeight += 5;\n\n                if(titleSide === 'top') {\n                    ax.domain[1] -= titleHeight / gs.h;\n                    titleTrans[1] *= -1;\n                } else {\n                    ax.domain[0] += titleHeight / gs.h;\n                    var nlines = svgTextUtils.lineCount(titleText);\n                    titleTrans[1] += (1 - nlines) * lineSize;\n                }\n\n                titleGroup.attr('transform', strTranslate(titleTrans[0], titleTrans[1]));\n                ax.setScale();\n            }\n        }\n\n        g.selectAll('.' + cn.cbfills + ',.' + cn.cblines)\n            .attr('transform', strTranslate(0, Math.round(gs.h * (1 - ax.domain[1]))));\n\n        axLayer.attr('transform', strTranslate(0, Math.round(-gs.t)));\n\n        var fills = g.select('.' + cn.cbfills)\n            .selectAll('rect.' + cn.cbfill)\n            .attr('style', '')\n            .data(fillLevels);\n        fills.enter().append('rect')\n            .classed(cn.cbfill, true)\n            .style('stroke', 'none');\n        fills.exit().remove();\n\n        var zBounds = zrange\n            .map(ax.c2p)\n            .map(Math.round)\n            .sort(function(a, b) { return a - b; });\n\n        fills.each(function(d, i) {\n            var z = [\n                (i === 0) ? zrange[0] : (fillLevels[i] + fillLevels[i - 1]) / 2,\n                (i === fillLevels.length - 1) ? zrange[1] : (fillLevels[i] + fillLevels[i + 1]) / 2\n            ]\n            .map(ax.c2p)\n            .map(Math.round);\n\n            // offset the side adjoining the next rectangle so they\n            // overlap, to prevent antialiasing gaps\n            z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]);\n\n\n            // Colorbar cannot currently support opacities so we\n            // use an opaque fill even when alpha channels present\n            var fillEl = d3.select(this).attr({\n                x: uPx,\n                width: Math.max(thickPx, 2),\n                y: d3.min(z),\n                height: Math.max(d3.max(z) - d3.min(z), 2),\n            });\n\n            if(opts._fillgradient) {\n                Drawing.gradient(fillEl, gd, opts._id, 'vertical', opts._fillgradient, 'fill');\n            } else {\n                // tinycolor can't handle exponents and\n                // at this scale, removing it makes no difference.\n                var colorString = fillColormap(d).replace('e-', '');\n                fillEl.attr('fill', tinycolor(colorString).toHexString());\n            }\n        });\n\n        var lines = g.select('.' + cn.cblines)\n            .selectAll('path.' + cn.cbline)\n            .data(line.color && line.width ? lineLevels : []);\n        lines.enter().append('path')\n            .classed(cn.cbline, true);\n        lines.exit().remove();\n        lines.each(function(d) {\n            d3.select(this)\n                .attr('d', 'M' + uPx + ',' +\n                    (Math.round(ax.c2p(d)) + (line.width / 2) % 1) + 'h' + thickPx)\n                .call(Drawing.lineGroupStyle, line.width, lineColormap(d), line.dash);\n        });\n\n        // force full redraw of labels and ticks\n        axLayer.selectAll('g.' + ax._id + 'tick,path').remove();\n\n        var shift = uPx + thickPx +\n            (outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n\n        var vals = Axes.calcTicks(ax);\n        var tickSign = Axes.getTickSigns(ax)[2];\n\n        Axes.drawTicks(gd, ax, {\n            vals: ax.ticks === 'inside' ? Axes.clipEnds(ax, vals) : vals,\n            layer: axLayer,\n            path: Axes.makeTickPath(ax, shift, tickSign),\n            transFn: Axes.makeTransTickFn(ax)\n        });\n\n        return Axes.drawLabels(gd, ax, {\n            vals: vals,\n            layer: axLayer,\n            transFn: Axes.makeTransTickLabelFn(ax),\n            labelFns: Axes.makeLabelFns(ax, shift)\n        });\n    }\n\n    // wait for the axis & title to finish rendering before\n    // continuing positioning\n    // TODO: why are we redrawing multiple times now with this?\n    // I guess autoMargin doesn't like being post-promise?\n    function positionCB() {\n        var innerThickness = thickPx + outlinewidth / 2;\n        if(ax.ticklabelposition.indexOf('inside') === -1) {\n            innerThickness += Drawing.bBox(axLayer.node()).width;\n        }\n\n        titleEl = titleCont.select('text');\n\n        if(titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n            var mathJaxNode = titleCont.select('.h' + ax._id + 'title-math-group').node();\n            var titleWidth;\n            if(mathJaxNode && ['top', 'bottom'].indexOf(titleSide) !== -1) {\n                titleWidth = Drawing.bBox(mathJaxNode).width;\n            } else {\n                // note: the formula below works for all title sides,\n                // (except for top/bottom mathjax, above)\n                // but the weird gs.l is because the titleunshift\n                // transform gets removed by Drawing.bBox\n                titleWidth = Drawing.bBox(titleCont.node()).right - uPx - gs.l;\n            }\n            innerThickness = Math.max(innerThickness, titleWidth);\n        }\n\n        var outerThickness = 2 * xpad + innerThickness + borderwidth + outlinewidth / 2;\n\n        g.select('.' + cn.cbbg).attr({\n            x: uPx - xpad - (borderwidth + outlinewidth) / 2,\n            y: vPx - lenPx - yExtraPx,\n            width: Math.max(outerThickness, 2),\n            height: Math.max(lenPx + 2 * yExtraPx, 2)\n        })\n        .call(Color.fill, opts.bgcolor)\n        .call(Color.stroke, opts.bordercolor)\n        .style('stroke-width', borderwidth);\n\n        g.selectAll('.' + cn.cboutline).attr({\n            x: uPx,\n            y: vPx - lenPx + ypad + (titleSide === 'top' ? titleHeight : 0),\n            width: Math.max(thickPx, 2),\n            height: Math.max(lenPx - 2 * ypad - titleHeight, 2)\n        })\n        .call(Color.stroke, opts.outlinecolor)\n        .style({\n            fill: 'none',\n            'stroke-width': outlinewidth\n        });\n\n        // fix positioning for xanchor!='left'\n        var xoffset = ({center: 0.5, right: 1}[xanchor] || 0) * outerThickness;\n        g.attr('transform', strTranslate(gs.l - xoffset, gs.t));\n\n        // auto margin adjustment\n        var marginOpts = {};\n        var tFrac = FROM_TL[yanchor];\n        var bFrac = FROM_BR[yanchor];\n        if(lenmode === 'pixels') {\n            marginOpts.y = optsY;\n            marginOpts.t = lenPx * tFrac;\n            marginOpts.b = lenPx * bFrac;\n        } else {\n            marginOpts.t = marginOpts.b = 0;\n            marginOpts.yt = optsY + len * tFrac;\n            marginOpts.yb = optsY - len * bFrac;\n        }\n\n        var lFrac = FROM_TL[xanchor];\n        var rFrac = FROM_BR[xanchor];\n        if(thicknessmode === 'pixels') {\n            marginOpts.x = optsX;\n            marginOpts.l = outerThickness * lFrac;\n            marginOpts.r = outerThickness * rFrac;\n        } else {\n            var extraThickness = outerThickness - thickPx;\n            marginOpts.l = extraThickness * lFrac;\n            marginOpts.r = extraThickness * rFrac;\n            marginOpts.xl = optsX - thickness * lFrac;\n            marginOpts.xr = optsX + thickness * rFrac;\n        }\n\n        Plots.autoMargin(gd, opts._id, marginOpts);\n    }\n\n    return Lib.syncOrAsync([\n        Plots.previousPromises,\n        drawDummyTitle,\n        drawAxis,\n        drawCbTitle,\n        Plots.previousPromises,\n        positionCB\n    ], gd);\n}\n\nfunction makeEditable(g, opts, gd) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n    var t0, xf, yf;\n\n    dragElement.init({\n        element: g.node(),\n        gd: gd,\n        prepFn: function() {\n            t0 = g.attr('transform');\n            setCursor(g);\n        },\n        moveFn: function(dx, dy) {\n            g.attr('transform', t0 + strTranslate(dx, dy));\n\n            xf = dragElement.align(opts._uFrac + (dx / gs.w), opts._thickFrac,\n                0, 1, opts.xanchor);\n            yf = dragElement.align(opts._vFrac - (dy / gs.h), opts._lenFrac,\n                0, 1, opts.yanchor);\n\n            var csr = dragElement.getCursor(xf, yf, opts.xanchor, opts.yanchor);\n            setCursor(g, csr);\n        },\n        doneFn: function() {\n            setCursor(g);\n\n            if(xf !== undefined && yf !== undefined) {\n                var update = {};\n                update[opts._propPrefix + 'x'] = xf;\n                update[opts._propPrefix + 'y'] = yf;\n                if(opts._traceIndex !== undefined) {\n                    Registry.call('_guiRestyle', gd, update, opts._traceIndex);\n                } else {\n                    Registry.call('_guiRelayout', gd, update);\n                }\n            }\n        }\n    });\n}\n\nfunction calcLevels(gd, opts, zrange) {\n    var levelsIn = opts._levels;\n    var lineLevels = [];\n    var fillLevels = [];\n    var l;\n    var i;\n\n    var l0 = levelsIn.end + levelsIn.size / 100;\n    var ls = levelsIn.size;\n    var zr0 = (1.001 * zrange[0] - 0.001 * zrange[1]);\n    var zr1 = (1.001 * zrange[1] - 0.001 * zrange[0]);\n\n    for(i = 0; i < 1e5; i++) {\n        l = levelsIn.start + i * ls;\n        if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n        if(l > zr0 && l < zr1) lineLevels.push(l);\n    }\n\n    if(opts._fillgradient) {\n        fillLevels = [0];\n    } else if(typeof opts._fillcolor === 'function') {\n        var fillLevelsIn = opts._filllevels;\n\n        if(fillLevelsIn) {\n            l0 = fillLevelsIn.end + fillLevelsIn.size / 100;\n            ls = fillLevelsIn.size;\n            for(i = 0; i < 1e5; i++) {\n                l = fillLevelsIn.start + i * ls;\n                if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n                if(l > zrange[0] && l < zrange[1]) fillLevels.push(l);\n            }\n        } else {\n            fillLevels = lineLevels.map(function(v) {\n                return v - levelsIn.size / 2;\n            });\n            fillLevels.push(fillLevels[fillLevels.length - 1] + levelsIn.size);\n        }\n    } else if(opts._fillcolor && typeof opts._fillcolor === 'string') {\n        // doesn't matter what this value is, with a single value\n        // we'll make a single fill rect covering the whole bar\n        fillLevels = [0];\n    }\n\n    if(levelsIn.size < 0) {\n        lineLevels.reverse();\n        fillLevels.reverse();\n    }\n\n    return {line: lineLevels, fill: fillLevels};\n}\n\nfunction mockColorBarAxis(gd, opts, zrange) {\n    var fullLayout = gd._fullLayout;\n\n    var cbAxisIn = {\n        type: 'linear',\n        range: zrange,\n        tickmode: opts.tickmode,\n        nticks: opts.nticks,\n        tick0: opts.tick0,\n        dtick: opts.dtick,\n        tickvals: opts.tickvals,\n        ticktext: opts.ticktext,\n        ticks: opts.ticks,\n        ticklen: opts.ticklen,\n        tickwidth: opts.tickwidth,\n        tickcolor: opts.tickcolor,\n        showticklabels: opts.showticklabels,\n        ticklabelposition: opts.ticklabelposition,\n        ticklabeloverflow: opts.ticklabeloverflow,\n        tickfont: opts.tickfont,\n        tickangle: opts.tickangle,\n        tickformat: opts.tickformat,\n        exponentformat: opts.exponentformat,\n        minexponent: opts.minexponent,\n        separatethousands: opts.separatethousands,\n        showexponent: opts.showexponent,\n        showtickprefix: opts.showtickprefix,\n        tickprefix: opts.tickprefix,\n        showticksuffix: opts.showticksuffix,\n        ticksuffix: opts.ticksuffix,\n        title: opts.title,\n        showline: true,\n        anchor: 'free',\n        side: 'right',\n        position: 1\n    };\n\n    var cbAxisOut = {\n        type: 'linear',\n        _id: 'y' + opts._id\n    };\n\n    var axisOptions = {\n        letter: 'y',\n        font: fullLayout.font,\n        noHover: true,\n        noTickson: true,\n        noTicklabelmode: true,\n        calendar: fullLayout.calendar  // not really necessary (yet?)\n    };\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n    }\n\n    handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n    handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n\n    return cbAxisOut;\n}\n\nmodule.exports = {\n    draw: draw\n};\n"]},"metadata":{},"sourceType":"script"}